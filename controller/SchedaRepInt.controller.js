sap.ui.define(["sap/ui/core/mvc/Controller","REPINTEMPOLEEY/REPINTEMPOLEEY/util/Formatter","sap/m/MessageBox","sap/m/library","sap/ui/core/library","sap/ui/core/Core","sap/m/MessageToast"],function(e,t,i,r,a,n,l){"use strict";var o=r.TimePickerMaskMode,s=a.ValueState;var I;var T=1e4;return e.extend("REPINTEMPOLEEY.REPINTEMPOLEEY.controller.SchedaRepInt",{Formatter:t,onInit:function(){var e=this;var t=this.getView();e._busyDialog=new sap.m.BusyDialog({showCancelButton:false});e.invioBozzaFlag=false;e.invioFlag=false},_getDialog:function(){if(!this._oDialog){this._oDialog=sap.ui.xmlfragment("REPINTEMPOLEEY.REPINTEMPOLEEY.fragment.TimeOutDiag",this.getView().getController());this.getView().addDependent(this._oDialog)}return this._oDialog},onPressRepintHome:function(e){var t=this;t._busyDialog.open();sap.m.URLHelper.redirect("https://repint-bfmyao56da.dispatcher.hana.ondemand.com",false);t._busyDialog.close()},onAfterRendering:function(){var e=this;if(e.getOwnerComponent().getModel("viewProperties").getProperty("/Authorized")){var i=new Date;var r=i.getMonth()+1;var a="";if(r<10){a="0"+r}else{a=r}e.getView().byId("dpAnnoMese").setValue(t.formatMeseAnno(i));e.getOwnerComponent().getModel("viewProperties").setProperty("/ANNOMESE",e.getView().byId("dpAnnoMese").getValue());var n=e.getOwnerComponent().getModel("basexsoModel");e.getEmpData(n)}else{var l=new sap.m.BusyDialog;l.open();sap.ui.core.UIComponent.getRouterFor(e).navTo("Unauthorized");l.close()}},getEmpData:function(e){var t=this;e.attachRequestSent(function(){t._busyDialog.open()});e.attachRequestCompleted(function(){t._busyDialog.close()});var r=t.getOwnerComponent().getModel("empModel").getData().name;var a=new sap.ui.model.json.JSONModel;var n=[];var l={};var o="/HANAMDC/REPINT/RepintEmployee/xsjs/EmployeeSet.xsjs/?aEmpid="+r;$.ajax({url:o,async:false,success:function(r){console.log("EmployeeSet"+r);l={ID:r[0].ID,MATRICOLA:r[0].MATRICOLA,COGNOME:r[0].COGNOME,NOME:r[0].NOME,CDC:r[0].CDC,EMAIL:r[0].EMAIL,STABILIMENTO_ATTUALE:r[0].STABILIMENTO_ATTUALE,LIVELLO:r[0].LIVELLO,MATRICOLA_RESP:r[0].MATRICOLA_RESP,UNITAORGANIZZATIVA:r[0].UNITAORGANIZZATIVA,DEPARTMENT:r[0].DEPARTMENT,ManagerFirstName:r[0].ManagerFirstName,ManagerLastName:r[0].ManagerLastName,STABILIMENTODESC:r[0].STABILIMENTODESC};n.push(l);l={};console.log(" EmployeeSet ");console.log(n);a.setData(n);t.getView().setModel(a,"RepintEmpdataModel");var o=new sap.ui.model.json.JSONModel;var s=[];var I={};var T=[];var A=t.getView().getModel("RepintEmpdataModel").getProperty("/0/MATRICOLA_RESP");if(A!==undefined&&A!==null&&A!==""){var g=new sap.ui.model.Filter("MATRICOLA_RESP",sap.ui.model.FilterOperator.Contains,A);T.push(g);e.read("/CambioResponsabileSet",{filters:T,success:function(e,i){for(var r=0;r<e.results.length;++r){I={MATRICOLA_RESP:e.results[r].MATRICOLA_RESP,NOME_RESP:e.results[r].NOME_RESP,COGNOME_RESP:e.results[r].COGNOME_RESP,MATRICOLA_DEPUTY:e.results[r].MATRICOLA_DELEGATO,COGNOME_DELEGATO:e.results[r].COGNOME_DELEGATO,NOME_DELEGATO:e.results[r].NOME_DELEGATO};s.push(I);I={}}console.log(" CAMBIO RESP ");console.log(s);o.setData(s);t.getView().byId("idRepintCambioResp").setModel(o,"RepintCambioRespModel")}.bind(this),error:function(e){i.error("Impossibile ottenere le informazioni del Responsabile/Deputy. Contatta l'amministratore");jQuery.sap.log.getLogger().error("RepintCambioResponsabile data fetch failed"+e.toString())}.bind(this)})}t.getEmpIdScheda()},error:function(e){i.error("Impossibile ottenere le informazioni del dipendente. Contatta l'amministratore");jQuery.sap.log.getLogger().error("Employee data fetch failed"+e.toString())}.bind(this)})},getEmpIdScheda:function(){var e=this;var r=new sap.ui.model.odata.ODataModel("/HANAMDC/REPINT/RepintEmployee/xsodata/RepintEmployee.xsodata/");r.attachRequestSent(function(){e._busyDialog.open()});r.attachRequestCompleted(function(){e._busyDialog.close()});var a=e.getView().getModel("RepintEmpdataModel").getProperty("/0/MATRICOLA");var n=e.getOwnerComponent().getModel("viewProperties").getProperty("/ANNOMESE").split("-")[0]+"-"+e.getOwnerComponent().getModel("viewProperties").getProperty("/ANNOMESE").split("-")[1];r.read("/HeaderSet?$filter=MATRICOLA eq '"+a+"' and ANNOMESE eq datetime'"+n+"-01'",{success:function(e,t){console.log(" IDSCHEDA Set ");console.log(e);if(e.results.length===0){this.getOwnerComponent().getModel("viewProperties").setProperty("/IDSCHEDA",0);this.onAddItems1New();this.onAddItems2New();this.getOwnerComponent().getModel("viewProperties").setProperty("/MATRICOLA_DEPUTY","");if(this.getView().getModel("RepintEmpHdrModel")!==undefined&&this.getView().getModel("RepintEmpHdrModel").getData()!==undefined&&this.getView().getModel("RepintEmpHdrModel").getData()!==null&&this.getView().getModel("RepintEmpHdrModel").getData().length>0){this.getView().getModel("RepintEmpHdrModel").setProperty("/0/MATRICOLA_DEPUTY","")}var i=[];var r={STATO:0};i.push(r);this.setButtonVisibility(i)}else{this.getOwnerComponent().getModel("viewProperties").setProperty("/IDSCHEDA",e.results[0].IDSCHEDA);this.getOwnerComponent().getModel("viewProperties").setProperty("/MATRICOLA_DEPUTY","");if(this.getView().getModel("RepintEmpHdrModel")!==undefined&&this.getView().getModel("RepintEmpHdrModel").getData()!==undefined&&this.getView().getModel("RepintEmpHdrModel").getData()!==null&&this.getView().getModel("RepintEmpHdrModel").getData().length>0){this.getView().getModel("RepintEmpHdrModel").setProperty("/0/MATRICOLA_DEPUTY","")}this.getExpandData("onload")}}.bind(this),error:function(e){i.error("Impossibile ottenere le informazioni della scheda REPINT. Contatta l'amministratore");jQuery.sap.log.getLogger().error("IDSCHEDA fetch failed"+e.toString())}.bind(this)});var l=new sap.ui.model.json.JSONModel;var o=[];var s={};r.read("/RiposiSet",{success:function(i,r){console.log(" RiposiSet");console.log(i.results);for(var a=0;a<i.results.length;++a){s={DACONTRATTO:i.results[a].DACONTRATTO,DURATA_INCLUSA:i.results[a].DURATA_INCLUSA,DURATA_MAX:i.results[a].DURATA_MAX,DURATA_MIN:i.results[a].DURATA_MIN,FASCIA_FINE:t.convertminstoHHSS(t.convertmstomins(i.results[a].FASCIA_FINE.ms)),FASCIA_INIZIO:t.convertminstoHHSS(t.convertmstomins(i.results[a].FASCIA_INIZIO.ms)),GIORNI:i.results[a].GIORNI,IDREGOLA:i.results[a].IDREGOLA,INCLUSO_DMAX:i.results[a].INCLUSO_DMAX,INCLUSO_DMIN:i.results[a].INCLUSO_DMIN,INCLUSO_FF:i.results[a].INCLUSO_FF,INCLUSO_FI:i.results[a].INCLUSO_FI,TIPO_COMPENSATIVO:i.results[a].TIPO_COMPENSATIVO,VALORE:i.results[a].VALORE};o.push(s);s={}}l.setData(o);e.getView().setModel(l,"RiposiModel")}.bind(this),error:function(e){i.error("Impossibile ottenere le informazioni delle regole del Riposo. Contatta l'amministratore");jQuery.sap.log.getLogger().error("Data fetch failed for Riposi. Please contact administrator."+e.toString())}.bind(this)});var I=new sap.ui.model.json.JSONModel;var T=[];var A={};r.read("/RipflagSet",{success:function(t,i){console.log(" RipflagSet");console.log(t.results);for(var r=0;r<t.results.length;++r){A={IDREGOLECOMPENSATIVIMULTI:t.results[r].IDREGOLECOMPENSATIVIMULTI,N_INTERVENTI:t.results[r].N_INTERVENTI,VALORE:t.results[r].VALORE,FASCIA_INIZIO:t.results[r].FASCIA_INIZIO,FASCIA_FINE:t.results[r].FASCIA_FINE};T.push(A);A={}}I.setData(T);e.getView().setModel(I,"RegoleCompensativi")}.bind(this),error:function(e){i.error("Impossibile ottenere le informazioni per calcolare RIP. Contatta l'amministratore");jQuery.sap.log.getLogger().error("Data fetch failed for RIP. Please contact administrator."+e.toString())}.bind(this)});var g=new sap.ui.model.json.JSONModel;var O=[];var N={};r.read("/ParamSet",{success:function(t,i){console.log(" ParamSet");console.log(t.results);for(var r=0;r<t.results.length;++r){N={PARAMETER_NAME:t.results[r].PARAMETER_NAME,PARAMETER_VALUE:t.results[r].PARAMETER_VALUE,DESCRIPTION:t.results[r].DESCRIPTION,DATETIME_CR:t.results[r].DATETIME_CR,DATETIME_LM:t.results[r].DATETIME_LM};O.push(N);N={}}g.setData(O);e.getView().setModel(g,"ParamSetModel")}.bind(this),error:function(e){i.error("Impossibile ottenere le informazione delle regole del RIP. Contatta l'amministratore");jQuery.sap.log.getLogger().error("Data fetch failed for ParamSet (RIP). Please contact administrator."+e.toString())}.bind(this)})},getExpandData:function(e){var r=this;r.getView().byId("dpAnnoMese").setValue(t.formatMeseAnno(r.getOwnerComponent().getModel("viewProperties").getProperty("/ANNOMESE")));var a=new Date(r.getOwnerComponent().getModel("viewProperties").getProperty("/ANNOMESE"));var n=new Date(a.getFullYear(),a.getMonth(),1);var l=new Date(a.getFullYear(),a.getMonth()+1,0);var o=new sap.ui.model.json.JSONModel;var s=[];var I={};var T=new sap.ui.model.json.JSONModel;var A=[];var g={};var O=this.getOwnerComponent().getModel("basexsoModel");var N=new sap.ui.model.odata.ODataModel("/HANAMDC/REPINT/RepintEmployee/xsodata/RepintEmployee.xsodata/");O.attachRequestSent(function(){r._busyDialog.open()});O.attachRequestCompleted(function(){r._busyDialog.close()});var E="/RepintEmpHeader(IDSCHEDA="+r.getOwnerComponent().getModel("viewProperties").getProperty("/IDSCHEDA")+")";var u={async:false,urlParameters:{$expand:"REPERIBILITA,INTERVENTI"},success:function(i,a){console.log("******* EXPAND ******");console.log(i);I={IDSCHEDA:i.IDSCHEDA,MATRICOLA:i.MATRICOLA,COGNOME:i.COGNOME,NOME:i.NOME,LIVELLO:i.LIVELLO,CDC:i.CDC,ANNOMESE:t.formatDate(i.ANNOMESE),STABILIMENTO:i.STABILIMENTO,MATRICOLA_RESP:i.MATRICOLA_RESP,MATRICOLA_DEPUTY:i.MATRICOLA_DEPUTY,AUT_DIPENDENTE:i.AUT_DIPENDENTE,AUT_RESP:i.AUT_RESP,AUT_HRGEST:i.AUT_HRGEST,STATO:i.STATO,DATACREAZIONE:sap.ui.core.format.DateFormat.getDateTimeInstance({pattern:"yyyy-MM-dd HH:mm"}).format(new Date(i.DATACREAZIONE)),DATE_MANAGER:i.DATE_MANAGER===null?"":sap.ui.core.format.DateFormat.getDateTimeInstance({pattern:"yyyy-MM-dd HH:mm"}).format(new Date(i.DATE_MANAGER)),DATE_HR:i.DATE_HR===null?"":sap.ui.core.format.DateFormat.getDateTimeInstance({pattern:"yyyy-MM-dd HH:mm"}).format(new Date(i.DATE_HR)),TOTALE_EROGATO:i.TOTALE_EROGATO,ANNOMESE_ORIG:t.formatDate(i.ANNOMESE_ORIG),STATO_ORIG:i.STATO_ORIG,DATA_SPOSTAMENTO_COMPETENZA:t.formatDate(i.DATA_SPOSTAMENTO_COMPETENZA)};s.push(I);I={};o.setData(s);r.getView().setModel(o,"RepintEmpHdrModel");console.log(r.getView().getModel("RepintEmpHdrModel").getData());for(var O=0;O<i.REPERIBILITA.results.length;O++){g={DATAREPERIBILITA:t.formatDate(i.REPERIBILITA.results[O].DATAREPERIBILITA),IDREPERIBILITA:i.REPERIBILITA.results[O].IDREPERIBILITA,IDSCHEDA:i.REPERIBILITA.results[O].IDSCHEDA,Fer:t.checkTipogiornoFer(i.REPERIBILITA.results[O].TIPOGIORNO),Sab:t.checkTipogiornoSab(i.REPERIBILITA.results[O].TIPOGIORNO),Dom:t.checkTipogiornoDom(i.REPERIBILITA.results[O].TIPOGIORNO),minDate:n,maxDate:l,oButton1:true,oButton2:true};A.push(g);g={}}if(A.length===0&&e==="onload"){r.onAddItems1New()}else if(A.length===0&&e==="success"){}else{T.setData(A);r.getView().byId("idTableReperibilita").setModel(T,"RepintReperibilitaModel");for(var O=0;O<i.REPERIBILITA.results.length;++O){r.chkFer(t.checkTipogiornoFer(i.REPERIBILITA.results[O].TIPOGIORNO));r.chkSab(t.checkTipogiornoSab(i.REPERIBILITA.results[O].TIPOGIORNO));r.chkDom(t.checkTipogiornoDom(i.REPERIBILITA.results[O].TIPOGIORNO))}r.getView().byId("txtAggiorna").setText(T.getData().length);r.getView().byId("txtElimina").setText(T.getData().length);console.log("REPERIBILITA DATA");console.log(r.getView().byId("idTableReperibilita").getModel("RepintReperibilitaModel"))}var N=new sap.ui.model.json.JSONModel;var E=[];var u={};for(var d=0;d<i.INTERVENTI.results.length;d++){if(i.INTERVENTI.results[d].FASCIA!==0){if(i.INTERVENTI.results[d].FASCIA===1){i.INTERVENTI.results[d].h1h=true;i.INTERVENTI.results[d].h12h=false;i.INTERVENTI.results[d].h24h=false;i.INTERVENTI.results[d].h46h=false;i.INTERVENTI.results[d].h68h=false;i.INTERVENTI.results[d].h8h=false}else if(i.INTERVENTI.results[d].FASCIA===2){i.INTERVENTI.results[d].h1h=false;i.INTERVENTI.results[d].h12h=true;i.INTERVENTI.results[d].h24h=false;i.INTERVENTI.results[d].h46h=false;i.INTERVENTI.results[d].h68h=false;i.INTERVENTI.results[d].h8h=false}else if(i.INTERVENTI.results[d].FASCIA===3){i.INTERVENTI.results[d].h1h=false;i.INTERVENTI.results[d].h12h=false;i.INTERVENTI.results[d].h24h=true;i.INTERVENTI.results[d].h46h=false;i.INTERVENTI.results[d].h68h=false;i.INTERVENTI.results[d].h8h=false}else if(i.INTERVENTI.results[d].FASCIA===4){i.INTERVENTI.results[d].h1h=false;i.INTERVENTI.results[d].h12h=false;i.INTERVENTI.results[d].h24h=false;i.INTERVENTI.results[d].h46h=true;i.INTERVENTI.results[d].h68h=false;i.INTERVENTI.results[d].h8h=false}else if(i.INTERVENTI.results[d].FASCIA===5){i.INTERVENTI.results[d].h1h=false;i.INTERVENTI.results[d].h12h=false;i.INTERVENTI.results[d].h24h=false;i.INTERVENTI.results[d].h46h=false;i.INTERVENTI.results[d].h68h=true;i.INTERVENTI.results[d].h8h=false}else if(i.INTERVENTI.results[d].FASCIA===6){i.INTERVENTI.results[d].h1h=false;i.INTERVENTI.results[d].h12h=false;i.INTERVENTI.results[d].h24h=false;i.INTERVENTI.results[d].h46h=false;i.INTERVENTI.results[d].h68h=false;i.INTERVENTI.results[d].h8h=true}}else{i.INTERVENTI.results[d].h1h=false;i.INTERVENTI.results[d].h12h=false;i.INTERVENTI.results[d].h24h=false;i.INTERVENTI.results[d].h46h=false;i.INTERVENTI.results[d].h68h=false;i.INTERVENTI.results[d].h8h=false}u={n:d+1,CAUSA:i.INTERVENTI.results[d].CAUSA===undefined||i.INTERVENTI.results[d].CAUSA===null?"":i.INTERVENTI.results[d].CAUSA,h1h:i.INTERVENTI.results[d].h1h,h12h:i.INTERVENTI.results[d].h12h,h24h:i.INTERVENTI.results[d].h24h,h46h:i.INTERVENTI.results[d].h46h,h68h:i.INTERVENTI.results[d].h68h,h8h:i.INTERVENTI.results[d].h8h,oButton1:true,oButton2:true,minDate:n,maxDate:l,CHIAMATODA:i.INTERVENTI.results[d].CHIAMATODA===undefined||i.INTERVENTI.results[d].CHIAMATODA===null?"":i.INTERVENTI.results[d].CHIAMATODA,CONTINTERVENTO:i.INTERVENTI.results[d].CONTINTERVENTO===null||i.INTERVENTI.results[d].CONTINTERVENTO===""||i.INTERVENTI.results[d].CONTINTERVENTO===0?0:i.INTERVENTI.results[d].CONTINTERVENTO,DATAINTERVENTO:t.formatDate(i.INTERVENTI.results[d].DATAINTERVENTO),DURATA:i.INTERVENTI.results[d].DURATA,FASCIA:i.INTERVENTI.results[d].FASCIA,FLAGCONT:i.INTERVENTI.results[d].FLAGCONT===1?true:false,FLAGNOTTURNO:i.INTERVENTI.results[d].FLAGNOTTURNO===undefined||i.INTERVENTI.results[d].FLAGNOTTURNO===null||i.INTERVENTI.results[d].FLAGNOTTURNO===0?false:true,IDINTERVENTO:i.INTERVENTI.results[d].IDINTERVENTO,IDSCHEDA:i.INTERVENTI.results[d].IDSCHEDA,ORAFINE:i.INTERVENTI.results[d].ORAFINE,ORAINIZIO:i.INTERVENTI.results[d].ORAINIZIO,STESSACAUSALE:i.INTERVENTI.results[d].STESSACAUSALE,WORKINGDAY:i.INTERVENTI.results[d].WORKINGDAY,NONWORKINGDAY:i.INTERVENTI.results[d].NONWORKINGDAY,MINDIFFORAINIFINE:i.INTERVENTI.results[d].DURATA,ORAINIZIOTIMESTAMP:new Date(i.INTERVENTI.results[d].ORAINIZIOTIMESTAMP),ORAFINETIMESTAMP:new Date(i.INTERVENTI.results[d].ORAFINETIMESTAMP),CHECKOK:i.INTERVENTI.results[d].CHECKOK,RIPOSI:i.INTERVENTI.results[d].RIPOSI,CHIAMATODA_ALTRO:i.INTERVENTI.results[d].CHIAMATODA_ALTRO===undefined||i.INTERVENTI.results[d].CHIAMATODA_ALTRO===null||i.INTERVENTI.results[d].CHIAMATODA_ALTRO===""?"":i.INTERVENTI.results[d].CHIAMATODA_ALTRO};E.push(u);u={}}if(E.length===0&&e==="onload"){var R=r.getView().byId("idTableInterventi").getModel("RepintInterventiModel");if(R){R.setData(null);R.updateBindings(true)}r.onAddItems2New();r.setButtonVisibility(r.getView().getModel("RepintEmpHdrModel").getData())}else{if(E.length===0&&e==="success"){}else{N.setData(E);r.getView().byId("idTableInterventi").setModel(N,"RepintInterventiModel");r.sortInterventiDateData(r.getView().byId("idTableInterventi").getModel("RepintInterventiModel"));for(var O=0;O<i.INTERVENTI.results.length;++O){if(i.INTERVENTI.results[O].h1h===true){r.chk1h(true);r.chk12h(false);r.chk24h(false);r.chk46h(false);r.chk68h(false);r.chk8h(false)}else if(i.INTERVENTI.results[O].h12h===true){r.chk1h(false);r.chk12h(true);r.chk24h(false);r.chk46h(false);r.chk68h(false);r.chk8h(false)}else if(i.INTERVENTI.results[O].h24h===true){r.chk1h(false);r.chk12h(false);r.chk24h(true);r.chk46h(false);r.chk68h(false);r.chk8h(false)}else if(i.INTERVENTI.results[O].h46h===true){r.chk1h(false);r.chk12h(false);r.chk24h(false);r.chk46h(true);r.chk68h(false);r.chk8h(false)}else if(i.INTERVENTI.results[O].h68h===true){r.chk1h(false);r.chk12h(false);r.chk24h(false);r.chk46h(false);r.chk68h(true);r.chk8h(false)}else if(i.INTERVENTI.results[O].h8h===true){r.chk1h(false);r.chk12h(false);r.chk24h(false);r.chk46h(false);r.chk68h(false);r.chk8h(true)}else{r.chk1h(false);r.chk12h(false);r.chk24h(false);r.chk46h(false);r.chk68h(false);r.chk8h(false)}}console.log("INTERVENTI DATA");console.log(r.getView().byId("idTableInterventi").getModel("RepintInterventiModel").getData());r.getView().byId("txtAggiorna1").setText(N.getData().length);r.getView().byId("txtElimina1").setText(N.getData().length);r.setButtonVisibility(r.getView().getModel("RepintEmpHdrModel").getData())}if(e==="success"){var D=r.getView().byId("idTableInterventi");var f=r.getView().byId("idTableReperibilita").getModel("RepintReperibilitaModel");var p=r.getView().byId("idTableInterventi").getModel("RepintInterventiModel");for(var h=0;h<p.getData().length;++h){r.checkForRIPAfterSubmitForCONTINTERVENTO(p)}p.updateBindings(true);r.setStessacausale(p);r.setButtonVisibility(r.getView().getModel("RepintEmpHdrModel").getData())}}var M=r.getView().getModel("RepintEmpHdrModel").getData()[0].MATRICOLA_DEPUTY;if(M!==""&&M!==null&&M!==undefined){var v=r.getView().byId("idRepintCambioResp").getModel("RepintCambioRespModel").getData();var m=jQuery.grep(v,function(e){return e.MATRICOLA_DEPUTY==M});console.log("MATRICOLA DEPUTY");console.log(m);if(m){if(m.length>0){r.getView().byId("idRepintCambioResp").setValue(m[0].NOME_DELEGATO+" "+m[0].COGNOME_DELEGATO);r.getOwnerComponent().getModel("viewProperties").setProperty("/MATRICOLA_DEPUTY",m[0].MATRICOLA_DEPUTY)}}}},error:function(e){i.error("Impossibile ottenere le informazioni della scheda REPINT. Contatta l'amministratore");jQuery.sap.log.getLogger().error("Data fetch failed for Repint Expand Service. Please contact administrator."+e.toString())}};O.read(E,u)},setButtonVisibility:function(e){console.log("Inside setButtonVisibility");var t;var i;this.getView().byId("idRejComment").setVisible(false);this.getView().byId("idlblRejComment").setVisible(false);this.getView().byId("idLblapp2").setText("Approvazione Line Manager:");this.getView().byId("idLblapp3").setText("Approvazione HR:");if(e[0].STATO===0){this.getView().byId("idButStornata").setEnabled(false);this.getView().byId("idButCreate").setEnabled(true);this.getView().byId("idButDraft").setEnabled(true);this.getView().byId("idStato").setText("In carico al Dipendente")}else if(e[0].STATO===100){this.getView().byId("idButStornata").setEnabled(true);this.getView().byId("idApprovazione2").setText("");this.getView().byId("idApprovazione3").setText("");this.getView().byId("idButCreate").setEnabled(false);this.getView().byId("idButDraft").setEnabled(false);this.getView().byId("idStato").setText("Approvata Dipendente");t=this.getView().byId("idTableReperibilita").getModel("RepintReperibilitaModel");if(t!==undefined&&t!==null&&t!==""){for(var r=0;r<t.getData().length;++r){t.setProperty("/"+r+"/oButton1",false);t.setProperty("/"+r+"/oButton2",false)}}i=this.getView().byId("idTableInterventi").getModel("RepintInterventiModel");if(i!==undefined&&i!==null&&i!==""){for(var r=0;r<i.getData().length;++r){i.setProperty("/"+r+"/oButton1",false);i.setProperty("/"+r+"/oButton2",false)}}var a=this.getView().byId("idTableReperibilita");var n;for(var l=0;l<a.getItems().length;++l){n=a.getItems()[l];this.disableControls(n,false)}var o=this.getView().byId("idTableInterventi");var s;for(var I=0;I<o.getItems().length;++I){s=o.getItems()[I];this.disableControls(s,false)}}else if(e[0].STATO===101||e[0].STATO===102){this.getView().byId("idButStornata").setEnabled(false);this.getView().byId("idButCreate").setEnabled(false);this.getView().byId("idButDraft").setEnabled(false);if(e[0].STATO===101){this.getView().byId("idStato").setText("Approvata Responsabile/Deputy")}else if(e[0].STATO===102){this.getView().byId("idStato").setText("Approvata HR")}t=this.getView().byId("idTableReperibilita").getModel("RepintReperibilitaModel");if(t!==undefined&&t!==null&&t!==""){for(var r=0;r<t.getData().length;++r){t.setProperty("/"+r+"/oButton1",false);t.setProperty("/"+r+"/oButton2",false)}}i=this.getView().byId("idTableInterventi").getModel("RepintInterventiModel");if(i!==undefined&&i!==null&&i!==""){for(var r=0;r<i.getData().length;++r){i.setProperty("/"+r+"/oButton1",false);i.setProperty("/"+r+"/oButton2",false)}}var a=this.getView().byId("idTableReperibilita");var n;for(var l=0;l<a.getItems().length;++l){n=a.getItems()[l];this.disableControls(n,false)}var o=this.getView().byId("idTableInterventi");var s;for(var I=0;I<o.getItems().length;++I){s=o.getItems()[I];this.disableControls(s,false)}}else if(e[0].STATO===201||e[0].STATO===202){this.getView().byId("idButStornata").setEnabled(false);this.getView().byId("idButCreate").setEnabled(true);this.getView().byId("idButDraft").setEnabled(true);this.getView().byId("idRejComment").setVisible(true);this.getView().byId("idlblRejComment").setVisible(true);if(e[0].STATO===201){this.getView().byId("idLblapp2").setText("Rifiutata Line Manager:");this.getView().byId("idStato").setText("Reject Responsabile");this.getView().byId("idlblRejComment").setText("Commento Responsabile:")}else if(e[0].STATO===202){this.getView().byId("idLblapp3").setText("Rifiutata HR:");this.getView().byId("idStato").setText("Reject HR");this.getView().byId("idlblRejComment").setText("HR Comment:")}this.getRejectionComment()}else if(e[0].STATO===300){this.getView().byId("idButStornata").setEnabled(false);this.getView().byId("idButCreate").setEnabled(true);this.getView().byId("idButDraft").setEnabled(true);this.getView().byId("idApprovazione1").setText("");this.getView().byId("idApprovazione2").setText("");this.getView().byId("idApprovazione3").setText("");this.getView().byId("idStato").setText("Stornata Approvazione Dipendente")}else if(e[0].STATO===301){this.getView().byId("idButStornata").setEnabled(true);this.getView().byId("idButCreate").setEnabled(false);this.getView().byId("idButDraft").setEnabled(false);this.getView().byId("idStato").setText("Stornata Approvazione Resp.");t=this.getView().byId("idTableReperibilita").getModel("RepintReperibilitaModel");if(t!==undefined&&t!==null&&t!==""){for(var r=0;r<t.getData().length;++r){t.setProperty("/"+r+"/oButton1",false);t.setProperty("/"+r+"/oButton2",false)}}i=this.getView().byId("idTableInterventi").getModel("RepintInterventiModel");if(i!==undefined&&i!==null&&i!==""){for(var r=0;r<i.getData().length;++r){i.setProperty("/"+r+"/oButton1",false);i.setProperty("/"+r+"/oButton2",false)}}var a=this.getView().byId("idTableReperibilita");var n;for(var l=0;l<a.getItems().length;++l){n=a.getItems()[l];this.disableControls(n,false)}var o=this.getView().byId("idTableInterventi");var s;for(var I=0;I<o.getItems().length;++I){s=o.getItems()[I];this.disableControls(s,false)}t.updateBindings(true);i.updateBindings(true)}else if(e[0].STATO===302){this.getView().byId("idButStornata").setEnabled(false);this.getView().byId("idButCreate").setEnabled(false);this.getView().byId("idButDraft").setEnabled(false);this.getView().byId("idStato").setText("Stornata Approvazione HR")}},getRejectionComment:function(){var e=this;var t=e.getOwnerComponent().getModel("basexsoModel");var r=e.getOwnerComponent().getModel("viewProperties").getProperty("/IDSCHEDA");var a=[];var n=new sap.ui.model.Filter("IDSCHEDA",sap.ui.model.FilterOperator.EQ,r);a.push(n);t.read("/COMMENTSET",{filters:a,success:function(t,i){if(t.results.length>0){e.getView().byId("idRejComment").setText(t.results[t.results.length-1].COMMENTO)}else{e.getView().byId("idRejComment").setText("")}}.bind(e),error:function(e){i.error("Impossibile ottenere le informazioni dei commenti pe ril motivo el rifiuto. Contatta l'amministratore");jQuery.sap.log.getLogger().error("Data fetch failed for COMMENTSET. Please contact administrator."+e.toString())}.bind(e)})},disableControls:function(e,t){var i=e.getCells();for(var r=0;r<i.length-2;r++){var a=i[r];var n=a.getMetadata();var l=n.getElementName();if(l==="sap.m.Input"||l==="sap.m.DatePicker"||l==="sap.m.TimePicker"||l==="sap.m.Select"){a.setEditable(t)}}},pressReperibilita:function(e){this.getView().byId("idInterventiVBox").setVisible(false);this.getView().byId("idReperibilitaVBox").setVisible(true);this.getView().byId("idTableReperibilita").setWidth("100%")},pressInterventi:function(e){this.getView().byId("idInterventiVBox").setVisible(true);this.getView().byId("idReperibilitaVBox").setVisible(false);this.getView().byId("idTableReperibilita").setWidth("30rem")},pressReperibilitaInterventi:function(e){this.getView().byId("idInterventiVBox").setVisible(true);this.getView().byId("idReperibilitaVBox").setVisible(true);this.getView().byId("idTableReperibilita").setWidth("30rem");this.getView().byId("idTableInterventi").setWidth("109rem")},handleValueHelp:function(e){var t=this;var i=e.getSource().sId;if(!t._valueHelpDialog){t._valueHelpDialog=sap.ui.xmlfragment("REPINTEMPOLEEY.REPINTEMPOLEEY.fragment.CambioResp",t);t._valueHelpDialog.setModel(t.getView().byId("idRepintCambioResp").getModel("RepintCambioRespModel"));sap.ui.getCore().byId(i).addDependent(t._valueHelpDialog)}t._valueHelpDialog.open()},_handleValueHelpSearch:function(e){var t=[];var i=e.getParameters("selectedItem").value;var r=new sap.ui.model.Filter("NOME_DELEGATO",sap.ui.model.FilterOperator.Contains,i);var a=new sap.ui.model.Filter("COGNOME_DELEGATO",sap.ui.model.FilterOperator.Contains,i);t=new sap.ui.model.Filter([r,a]);var n=sap.ui.getCore().byId("idSelectDiagCambioResp");var l=n.getBinding("items");l.filter(t)},_handleValueHelpClose:function(e){var t=e.getParameter("selectedItem"),i=this.getView().byId("idRepintCambioResp");if(!t){i.resetProperty("value");return}i.setValue(t.getTitle());this.getOwnerComponent().getModel("viewProperties").setProperty("/MATRICOLA_DEPUTY",sap.ui.getCore().byId("idSelectDiagCambioResp").getModel("RepintCambioRespModel").getProperty(e.getParameter("selectedItem").getBindingContextPath()+"/MATRICOLA_DEPUTY"))},_handleValueHelpCancel:function(e){this.getOwnerComponent().getModel("viewProperties").setProperty("/MATRICOLA_DEPUTY","");var t=e.getParameter("selectedItem"),i=this.getView().byId("idRepintCambioResp");if(!t){i.resetProperty("value");return}},navigateReperibilitaDate:function(e){console.log(e);if(e.getSource().getValue()!==""&&e.getSource().getValue()!==null){this.getOwnerComponent().getModel("viewProperties").setProperty("/oldReperbilitaDate",e.getSource().getValue())}else{this.getOwnerComponent().getModel("viewProperties").setProperty("/oldReperbilitaDate",null)}},handleDateChange:function(e){var t=this;var i;if(t.ReperInterventiDateCheckForLPN(e)){if(t.getOwnerComponent().getModel("viewProperties").getProperty("/oldReperbilitaDate")===""||t.getOwnerComponent().getModel("viewProperties").getProperty("/oldReperbilitaDate")===null){t.setReperbilitaDateLSF(e)}else{var r=e.getSource().getParent().getParent().indexOfItem(e.getSource().getParent());if(t.setReperbilitaDateLSF(e)){i=e.getParameter("newValue")}else{i=null}var a=this.getView().byId("idTableInterventi").getModel("RepintInterventiModel").getProperty("/");var n=t.getOwnerComponent().getModel("viewProperties").getProperty("/oldReperbilitaDate");var l=a.length;while(l--){if(n===a[l].DATAINTERVENTO){a[l].DATAINTERVENTO=i;t.handleInterventiDateUpdate(i,l,r)}}}}},ReperInterventiDateCheckForLPN:function(e){var t=e.getParameter("newValue");var r=this.getView().byId("idTableReperibilita").getModel("RepintReperibilitaModel");var a=this.getView().byId("idTableInterventi").getModel("RepintInterventiModel");var n=e.getSource().getParent().getParent().indexOfItem(e.getSource().getParent());for(var l=0;l<a.getData().length;++l){if(t===a.getData()[l].DATAINTERVENTO){if(a.getData()[l].FLAGNOTTURNO===true&&(a.getData()[l].DATAINTERVENTO!==""&&a.getData()[l].DATAINTERVENTO!==undefined&&a.getData()[l].DATAINTERVENTO!==null)){e.getSource().setDateValue(null);this.getView().byId("idTableReperibilita").getItems()[n].getCells()[0].setValueState(sap.ui.core.ValueState.Error);i.error("Non è possibile inserire per LPN una data presente in Reperibilità");return false}}}return true},setReperbilitaDateLSF:function(e){var t=this.getView().byId("idTableReperibilita").getModel("RepintReperibilitaModel");var r=false;if(t.getData().length>1){var a=e.getSource().getParent().getParent().indexOfItem(e.getSource().getParent());for(var n=0;n<t.getData().length;++n){if(e.getParameter("newValue")===t.getData()[n].DATAREPERIBILITA&&a!==n){r=true;break}}if(r){this.resetReperbilitaValues(t,a);i.error("La data selezionata è già utilizzata. Seleziona un valore differente");return false}else{t.getData()[a].DATAREPERIBILITA=e.getParameter("newValue")}}if(!r){this.getLSF(e);var l;var o=this.getView().byId("idTableReperibilita");var s=new sap.ui.model.json.JSONModel;var t=o.getModel("RepintReperibilitaModel");l=this.sortReperibilitaDateData(t);s.setData(l);s.updateBindings(true);s.refresh();o.setModel(s,"RepintReperibilitaModel");return true}},getLSF:function(e){var t=this;var r=e.getParameter("newValue").split("-");var a=r[0];var n=r[1];var l=r[2];var o=n+"-"+a;var s=t.getOwnerComponent().getModel("empModel").getData().name;var I=l+"-"+n+"-"+a+"T00:00:00";var T="/HANAMDC/REPINT/RepintEmployee/xsjs/getLSF.xsjs/?aDate='"+o+"'&aEmpid='"+s+"'&aCompleteDate="+I;var A=t.getView().byId("idTableReperibilita").getModel("RepintReperibilitaModel");var g=A.getProperty("/");var O=e.getSource().getParent().getParent().indexOfItem(e.getSource().getParent());g[O].Dom=false;g[O].Fer=false;g[O].Sab=false;$.ajax({url:T,async:false,success:function(e){console.log(e);for(var i=0;i<e.length;++i){if(e[i].F!==undefined&&e[i].F!==null){g[O].Dom=true;t.chkDom(true);t.chkSab(false);t.chkFer(false)}else if(e[i].S!==undefined&&e[i].S!==null){g[O].Sab=true;t.chkSab(true);t.chkFer(false);t.chkDom(false)}else{g[O].Fer=true;t.chkFer(true);t.chkSab(false);t.chkDom(false)}}t.getView().byId("idTableReperibilita").getModel("RepintReperibilitaModel").setProperty("/",g)},error:function(e,t,r){i.error("Impossibile ottenere le informazioni in merito alla variazione della data di reperbilità. Contatta l'amministratore");jQuery.sap.log.getLogger().error("Data fetch failed while calling getLSF function for Reperibilita Date change. Please contact administrator."+r.toString())}})},getLSFForMultiCalc:function(e){var t=this;t.LSFHolidayFlag=false;var r=e.split("-");var a=r[0];var n=r[1];var l=r[2];var o=n+"-"+a;var s=t.getOwnerComponent().getModel("empModel").getData().name;var I=l+"-"+n+"-"+a+"T00:00:00";var T="/HANAMDC/REPINT/RepintEmployee/xsjs/getLSF.xsjs/?aDate='"+o+"'&aEmpid='"+s+"'&aCompleteDate="+I;$.ajax({url:T,async:false,success:function(e){console.log(e);for(var i=0;i<e.length;++i){if(e[i].F!==undefined&&e[i].F!==null){t.LSFHolidayFlag=true}else if(e[i].S!==undefined&&e[i].S!==null){t.LSFHolidayFlag=true}else{t.LSFHolidayFlag=false}}},error:function(e,t,r){i.error("Impossibile ottenere le informazioni delle regole per il calcolo del riposo. Contatta l'amministratore");jQuery.sap.log.getLogger().error("Data fetch failed while calling getLSF for Multi Calculation.Please contact administrator."+r.toString())}})},getLSFForInterventiLPN:function(e,t,r){var a=this;var n;var l;if(e!==""){l=e.getParameter("newValue").split("-");n=e.getSource().getParent().getParent().indexOfItem(e.getSource().getParent())}else{l=t.split("-");n=r}var o=l[0];var s=l[1];var I=l[2];var T=s+"-"+o;var A=a.getOwnerComponent().getModel("empModel").getData().name;var g=I+"-"+s+"-"+o+"T00:00:00";var O="/HANAMDC/REPINT/RepintEmployee/xsjs/getLSF.xsjs/?aDate='"+T+"'&aEmpid='"+A+"'&aCompleteDate="+g;var N=a.getView().byId("idTableInterventi").getModel("RepintInterventiModel");$.ajax({url:O,async:false,success:function(e){for(var t=0;t<e.length;++t){if(e[t].F!==undefined&&e[t].F!==null||e[t].S!==undefined&&e[t].S!==null){N.getData()[n].WORKINGDAY=false;N.getData()[n].NONWORKINGDAY=true}else{N.getData()[n].WORKINGDAY=true;N.getData()[n].NONWORKINGDAY=false}}},error:function(e,t,r){i.error("Impossibile ottenere le informazioni per il calcolo di LPN. Contatta l'amministratore");jQuery.sap.log.getLogger().error("Data fetch failed while calling getLSFForInterventiLPN function for LPN condition . Please contact administrator."+r.toString())}})},resetInterventiValues:function(e,t,i){e.getItems()[i].getCells()[3].setValueState(sap.ui.core.ValueState.None);e.getItems()[i].getCells()[4].setValueState(sap.ui.core.ValueState.None);t.getData()[i].ORAINIZIOTIMESTAMP=null;t.getData()[i].ORAFINETIMESTAMP=null;t.getData()[i].ORAINIZIO=null;t.getData()[i].ORAFINE=null;t.getData()[i].FLAGCONT=false;t.getData()[i].RIPOSI=null;t.getData()[i].h1h=false;t.getData()[i].h12h=false;t.getData()[i].h24h=false;t.getData()[i].h46h=false;t.getData()[i].h68h=false;t.getData()[i].h8h=false},resetReperbilitaValues:function(e,t){var i=e.getProperty("/");i[t].DATAREPERIBILITA=null;i[t].Dom=false;i[t].Sab=false;i[t].Fer=false},handleInterventiDateUpdate:function(e,t,i){var r=this.getView().byId("idTableReperibilita").getModel("RepintReperibilitaModel");var a=this.getView().byId("idTableInterventi").getModel("RepintInterventiModel");this.resetInterventiValues(this.getView().byId("idTableInterventi"),a,t);if(r.getData()[i].Fer===true){a.getData()[t].WORKINGDAY=true;a.getData()[t].NONWORKINGDAY=false}else{a.getData()[t].WORKINGDAY=false;a.getData()[t].NONWORKINGDAY=true}if(a.getData()[t].FLAGNOTTURNO===true){a.getData()[t].RIPOSI=null;this.getLSFForInterventiLPN("",e,t)}r.updateBindings(true);a.updateBindings(true)},handleInterventiDateChange:function(e){var t=this.getView().byId("idTableReperibilita").getModel("RepintReperibilitaModel");var r=this.getView().byId("idTableInterventi").getModel("RepintInterventiModel");var a=e.getSource().getParent().getParent().indexOfItem(e.getSource().getParent());this.resetInterventiValues(this.getView().byId("idTableInterventi"),r,a);var n=false;for(var l=0;l<t.getData().length;++l){if(e.getParameter("newValue")===t.getData()[l].DATAREPERIBILITA){n=true;if(t.getData()[l].Fer===true){r.getData()[a].WORKINGDAY=true;r.getData()[a].NONWORKINGDAY=false}else{r.getData()[a].WORKINGDAY=false;r.getData()[a].NONWORKINGDAY=true}}}if(!n&&r.getData()[a].FLAGNOTTURNO!==true){e.getSource().setDateValue(null);this.resetInterventiValues(this.getView().byId("idTableInterventi"),r,a);this.getView().byId("idTableInterventi").getItems()[a].getCells()[2].setValueState(sap.ui.core.ValueState.Error);i.error("Per l'intervento inserire una data presente in Reperibilità");return}if(n&&r.getData()[a].FLAGNOTTURNO===true){e.getSource().setDateValue(null);this.resetInterventiValues(this.getView().byId("idTableInterventi"),r,a);this.getView().byId("idTableInterventi").getItems()[a].getCells()[2].setValueState(sap.ui.core.ValueState.Error);i.error("La data di Intervento selezionata non deve essere uguale a nessuna data di ripetibilità inserita");return}if(r.getData()[a].FLAGNOTTURNO===true){r.getData()[a].RIPOSI=null;this.getLSFForInterventiLPN(e,"","")}this.filterRiposiSet(this.getView().byId("idTableInterventi"),t,r,a,false)},resetCHECKOKvalue:function(e){for(var t=0;t<e.length;++t){e[t].CHECKOK="N"}},filterRiposiSet:function(e,r,a,n,l){var o=this;var s;var I;var T=o.getView().getModel("RiposiModel").getData();var A;var g=[];var O={};var N=true;var E=new sap.ui.model.json.JSONModel;A=o.sortInterventiDateData(a);E.setData(A);e.setModel(E,"RepintInterventiModel");for(var u=0;u<A.length;++u){if(A[u].DATAINTERVENTO===null||A[u].DATAINTERVENTO===""||A[u].DATAINTERVENTO===undefined){e.getItems()[u].getCells()[2].setValueState(sap.ui.core.ValueState.Error);N=false;if(!l){i.error("Nella sezione Interventi valorizzata il campo data")}return}else{e.getItems()[u].getCells()[2].setValueState(sap.ui.core.ValueState.None)}if(A[u].ORAFINE===null||A[u].ORAFINE===""||A[u].ORAFINE===undefined){N=false;return}else{e.getItems()[u].getCells()[3].setValueState(sap.ui.core.ValueState.None)}if(A[u].ORAFINE===null||A[u].ORAFINE===""||A[u].ORAFINE===undefined){N=false;i.error('Il campo "Ora Fine" non può essere lasciato vuoto');return}else{e.getItems()[u].getCells()[4].setValueState(sap.ui.core.ValueState.None)}if(A[u].ORAINIZIOTIMESTAMP===""||A[u].ORAINIZIOTIMESTAMP===undefined||A[u].ORAINIZIOTIMESTAMP===null){e.getItems()[u].getCells()[3].setValueState(sap.ui.core.ValueState.Error);e.getItems()[u].getCells()[4].setValueState(sap.ui.core.ValueState.Error);N=false;return}else{e.getItems()[u].getCells()[3].setValueState(sap.ui.core.ValueState.None);e.getItems()[u].getCells()[4].setValueState(sap.ui.core.ValueState.None)}if(A[u].ORAFINETIMESTAMP===""||A[u].ORAFINETIMESTAMP===undefined||A[u].ORAFINETIMESTAMP===null){e.getItems()[u].getCells()[3].setValueState(sap.ui.core.ValueState.Error);e.getItems()[u].getCells()[4].setValueState(sap.ui.core.ValueState.Error);N=false;return}else{e.getItems()[u].getCells()[3].setValueState(sap.ui.core.ValueState.None);e.getItems()[u].getCells()[4].setValueState(sap.ui.core.ValueState.None)}}if(N){console.log("SORTED DATA"+A);o.resetCHECKOKvalue(A);if(o.getOwnerComponent().getModel("viewProperties").getProperty("/oRiposiWorkingDay")===undefined){s=jQuery.grep(T,function(e){return e.GIORNI==1});o.getOwnerComponent().getModel("viewProperties").setProperty("/oRiposiWorkingDay",s)}else{s=o.getOwnerComponent().getModel("viewProperties").getProperty("/oRiposiWorkingDay")}if(o.getOwnerComponent().getModel("viewProperties").getProperty("/oRiposiNonWorkingDay")===undefined){I=jQuery.grep(T,function(e){return e.GIORNI==5});o.getOwnerComponent().getModel("viewProperties").setProperty("/oRiposiNonWorkingDay",I)}else{I=o.getOwnerComponent().getModel("viewProperties").getProperty("/oRiposiNonWorkingDay")}var d;var R;var D;var f;var p;var h;var M;var v;var m;var V;for(var S=0;S<A.length;++S){if(A[S].WORKINGDAY){R=A[S].ORAINIZIOTIMESTAMP;D=A[S].ORAFINETIMESTAMP;d=new Date(t.formatDateToMMDDYYYY(A[S].DATAINTERVENTO));h=new Date(t.formatDateToMMDDYYYY(A[S].DATAINTERVENTO));f=new Date(t.formatDateToMMDDYYYY(A[S].DATAINTERVENTO));h.setDate(f.getDate()+1);p=new Date(f.getFullYear(),f.getMonth(),f.getDate(),s[0].FASCIA_INIZIO.split(":")[0],s[0].FASCIA_INIZIO.split(":")[1],"00");M=new Date(h.getFullYear(),h.getMonth(),h.getDate(),s[0].FASCIA_FINE.split(":")[0],s[0].FASCIA_FINE.split(":")[1],"00");if(R>=p&&R<=M&&D>=p&&D<=M){A[S].CHECKOK="Y"}else{if(R<p&&(D>p&&D<=M)){A[S].CHECKOK="Y";V=Math.abs(D-p)/1e3;A[S].MINDIFFORAINIFINE=Math.floor(V/60)}else{A[S].CHECKOK="N"}}}else{A[S].CHECKOK="Y"}}console.log("REPOSI");console.log(A);this.calculateCompensativi(A,l)}},sortInterventiDateData:function(e){var t=e.getData().sort(function(e,t){if(e.DATAINTERVENTO!==""&&t.DATAINTERVENTO!==""){if(e.DATAINTERVENTO<t.DATAINTERVENTO)return-1;if(e.DATAINTERVENTO>t.DATAINTERVENTO)return 1;return 0}});return t},sortInterventiDataForOraInzio:function(e){var t=e.getData().sort(function(e,t){if(e.ORAINIZIOTIMESTAMP!==""&&t.ORAINIZIOTIMESTAMP!==""){if(e.ORAINIZIOTIMESTAMP<t.ORAINIZIOTIMESTAMP)return-1;if(e.ORAINIZIOTIMESTAMP>t.ORAINIZIOTIMESTAMP)return 1;return 0}});return t},sortReperibilitaDateData:function(e){var t=e.getData().sort(function(e,t){if(e.DATAREPERIBILITA!==""&&t.DATAREPERIBILITA!==""){if(e.DATAREPERIBILITA<t.DATAREPERIBILITA)return-1;if(e.DATAREPERIBILITA>t.DATAREPERIBILITA)return 1;return 0}});return t},resetRiposi:function(e){for(var t=0;t<e.length;++t){e[t].RIPOSI=""}},calculateCompensativi:function(e,i){var r=this;var a=false;var n;var l;var o;var s;var I;var T;var A;var g;var O;var N;var E=0;var u=0;var d=false;var R=false;var D;var f;var p;var h;var M;var v;r.resetRiposi(e);var m=r.getOwnerComponent().getModel("viewProperties").getProperty("/oRiposiWorkingDay");var V=r.getOwnerComponent().getModel("viewProperties").getProperty("/oRiposiNonWorkingDay");var S=r.getView().getModel("RegoleCompensativi").getData();var c=$.unique(e.map(function(e){return e.DATAINTERVENTO}));var P=0;var b=0;var C=0;var w=0;var L=0;c.map(function(s){P=0;b=0;C=0;d=false;R=false;w=0;var c=[];var F={};var y={};$.each(e,function(e,i){if(i.DATAINTERVENTO.toString()===s.toString()&&i.CHECKOK==="Y"&&!i.FLAGCONT){D=new Date(t.formatDateToMMDDYYYY(i.DATAINTERVENTO));f=new Date(t.formatDateToMMDDYYYY(i.DATAINTERVENTO));f.setDate(D.getDate()+1);r.getLSFForMultiCalc(t.formatDateMulti(f));if(!r.LSFHolidayFlag){n=i.ORAINIZIOTIMESTAMP;l=i.ORAFINETIMESTAMP;p=new Date(t.formatDateToMMDDYYYY(i.DATAINTERVENTO));h=new Date(t.formatDateToMMDDYYYY(i.DATAINTERVENTO));h.setDate(D.getDate()+1);M=new Date(p.getFullYear(),p.getMonth(),p.getDate(),"23","00","00");v=new Date(h.getFullYear(),h.getMonth(),h.getDate(),"08","30","00");if(n>=M&&n<=v&&l>=M&&l<=v){w=w+1}}}});for(var Y=0;Y<S.length;Y++){if(w>=S[0].N_INTERVENTI){L=S[0].VALORE}}for(var _=0;_<e.length;++_){if(e[_].DATAINTERVENTO===s){if(e[_].WORKINGDAY){d=true;P=0;$.each(e,function(e,i){if(i.DATAINTERVENTO.toString()===s.toString()&&i.CHECKOK==="Y"&&!i.FLAGCONT){n=i.ORAINIZIOTIMESTAMP;l=i.ORAFINETIMESTAMP;A=new Date(t.formatDateToMMDDYYYY(i.DATAINTERVENTO));o=new Date(t.formatDateToMMDDYYYY(i.DATAINTERVENTO));I=new Date(t.formatDateToMMDDYYYY(i.DATAINTERVENTO));I.setDate(o.getDate()+1);O=new Date(A.getFullYear(),A.getMonth(),A.getDate(),"22","00","00");T=new Date(I.getFullYear(),I.getMonth(),I.getDate(),"08","30","00");if(n>=O&&n<=T&&l>=O&&l<=T){P=P+i.MINDIFFORAINIFINE}else{if(n<O&&(l>O&&l<=T)){P=P+i.MINDIFFORAINIFINE}}}});for(var G=0;G<m.length;++G){if(m[G].DURATA_MIN<P&&P<=m[G].DURATA_MAX){n=e[_].ORAINIZIOTIMESTAMP;l=e[_].ORAFINETIMESTAMP;o=new Date(t.formatDateToMMDDYYYY(e[_].DATAINTERVENTO));I.setDate(o.getDate()+1);O=new Date(o.getFullYear(),o.getMonth(),o.getDate(),"22","00","00");T=new Date(I.getFullYear(),I.getMonth(),I.getDate(),"08","30","00");if(n>=O&&n<=T&&l>O&&l<=T){if(w<3){F={InterventiDate:s,RiposiValue:(m[G].VALORE*8).toString()+"H",multi:"("+0+" Multi)"}}else{F={InterventiDate:s,RiposiValue:(m[G].VALORE*8).toString()+"H",multi:"("+L.toString()+" Multi)"}}c.push(F);F={};a=true;break}else{if(n<O&&(l>O&&l<=T)){if(w<3){F={InterventiDate:s,RiposiValue:(m[G].VALORE*8).toString()+"H",multi:"("+0+" Multi)"}}else{F={InterventiDate:s,RiposiValue:(m[G].VALORE*8).toString()+"H",multi:"("+L.toString()+" Multi)"}}c.push(F);F={};a=true;break}}}}}else{R=true;b=0;C=0;$.each(e,function(e,i){if(i.DATAINTERVENTO.toString()===s.toString()&&i.CHECKOK==="Y"&&!i.FLAGCONT){n=i.ORAINIZIOTIMESTAMP;l=i.ORAFINETIMESTAMP;o=new Date(t.formatDateToMMDDYYYY(i.DATAINTERVENTO));A=new Date(t.formatDateToMMDDYYYY(i.DATAINTERVENTO));g=new Date(o);O=new Date(A.getFullYear(),A.getMonth(),A.getDate(),"08","30","00");N=new Date(g.getFullYear(),g.getMonth(),g.getDate(),"22","00","00");if(n>=O&&n<=N&&l>=O&&l<=N){b=b+i.MINDIFFORAINIFINE}o=new Date(t.formatDateToMMDDYYYY(i.DATAINTERVENTO));I=new Date(t.formatDateToMMDDYYYY(i.DATAINTERVENTO));I.setDate(o.getDate()+1);O=new Date(A.getFullYear(),A.getMonth(),A.getDate(),"22","00","00");T=new Date(I.getFullYear(),I.getMonth(),I.getDate(),"08","30","00");if(n<O&&(l>=O&&l<=T)){C=C+i.MINDIFFORAINIFINE}else if(n>=O&&n<=T&&l>=O&&l<=T){C=C+i.MINDIFFORAINIFINE}}});for(var G=0;G<V.length;++G){if(V[G].DURATA_MIN===240&&V[G].DURATA_MAX===480||V[G].DURATA_MIN===480&&V[G].DURATA_MAX===1440){if(V[G].DURATA_MIN<b&&b<=V[G].DURATA_MAX){n=e[_].ORAINIZIOTIMESTAMP;l=e[_].ORAFINETIMESTAMP;o=new Date(t.formatDateToMMDDYYYY(e[_].DATAINTERVENTO));A=new Date(t.formatDateToMMDDYYYY(e[_].DATAINTERVENTO));g=new Date(o);O=new Date(A.getFullYear(),A.getMonth(),A.getDate(),"08","30","00");N=new Date(g.getFullYear(),g.getMonth(),g.getDate(),"22","00","00");if(n>=O&&n<=N&&l>=O&&l<=N){if(w<3){F={InterventiDate:s,RiposiValue:(V[G].VALORE*8).toString()+"H",multi:"("+0+" Multi)"}}else{F={InterventiDate:s,RiposiValue:(V[G].VALORE*8).toString()+"H",multi:"("+L.toString()+" Multi)"}}c.push(F);F={};a=true;break}}}else{if(V[G].DURATA_MIN===60&&V[G].DURATA_MAX===120||V[G].DURATA_MIN===120&&V[G].DURATA_MAX===240||V[G].DURATA_MIN===240&&V[G].DURATA_MAX===1440){if(V[G].DURATA_MIN<C&&C<=V[G].DURATA_MAX){n=e[_].ORAINIZIOTIMESTAMP;l=e[_].ORAFINETIMESTAMP;o=new Date(t.formatDateToMMDDYYYY(e[_].DATAINTERVENTO));I=new Date(t.formatDateToMMDDYYYY(e[_].DATAINTERVENTO));I.setDate(o.getDate()+1);O=new Date(o.getFullYear(),o.getMonth(),o.getDate(),"22","00","00");T=new Date(I.getFullYear(),I.getMonth(),I.getDate(),"08","30","00");if(n>=O&&n<=T&&l>=O&&l<=T){if(w<3){F={InterventiDate:s,RiposiValue:(V[G].VALORE*8).toString()+"H",multi:"("+0+" Multi)"}}else{F={InterventiDate:s,RiposiValue:(V[G].VALORE*8).toString()+"H",multi:"("+L.toString()+" Multi)"}}c.push(F);F={};a=true;break}else if(n<O&&(l>=O&&l<=T)){if(w<3){F={InterventiDate:s,RiposiValue:(V[G].VALORE*8).toString()+"H",multi:"("+0+" Multi)"}}else{F={InterventiDate:s,RiposiValue:(V[G].VALORE*8).toString()+"H",multi:"("+L.toString()+" Multi)"}}c.push(F);F={};a=true;break}}}}}}}}var H=[];if(R){if(c.length>0){H.push(c[c.length-1]);if(b!==0&&C===0){if(c[0].RiposiValue!==""&&c[0].RiposiValue!==undefined&&c[0].RiposiValue!==null){u=c[0].RiposiValue;E=parseInt(u.substr(0,u.indexOf("H")))}}else if(C!==0&&b===0){if(c[0].RiposiValue!==""&&c[0].RiposiValue!==undefined&&c[0].RiposiValue!==null){u=c[0].RiposiValue;E=parseInt(u.substr(0,u.indexOf("H")))}}else{for(var _=0;_<c.length;++_){if(c.length==1){if(c[_].RiposiValue!==""&&c[_].RiposiValue!==undefined&&c[_].RiposiValue!==null){u=c[_].RiposiValue;E=parseInt(u.substr(0,u.indexOf("H")))}else{E=0}}else{if(c[_].RiposiValue!==""&&c[_].RiposiValue!==undefined&&c[_].RiposiValue!==null){u=c[_].RiposiValue;E=E+parseInt(u.substr(0,u.indexOf("H")))}}}}if(E>8){E=8}H[0].RiposiValue=E+"H"}}else if(d){if(c.length>0){H=r.unique(c)}}var U=r.getView().byId("idTableInterventi").getModel("RepintInterventiModel");for(var x=0;x<e.length;++x){for(var Z=0;Z<H.length;++Z){if(e[x].DATAINTERVENTO===H[Z].InterventiDate){U.getData()[x].RIPOSI=H[Z].RiposiValue+" "+H[Z].multi;H.splice(0,1);break}}}r.getView().byId("idTableInterventi").getModel("RepintInterventiModel").updateBindings(true);r.checkForRIP(r.getView().byId("idTableInterventi").getModel("RepintInterventiModel"),i)})},unique:function(e){var t=[];var i={};for(var r=0,a=e.length;r<a;r++){var n=JSON.stringify(e[r]);if(i[n]){continue}t.push(e[r]);i[n]=true}return t},uniqueInterCalcu:function(e){var t=[];var i={};var r="";for(var a=0,n=e.length;a<n;a++){r={DATAINTERVENTO:e[a].DATAINTERVENTO,TimeSlot:e[a].TimeSlot};var l=JSON.stringify(r);if(i[l]){continue}t.push(e[a]);i[l]=true}return t},resetContinterventoFlagCountChiamatoda:function(e){for(var t=0;t<e.getData().length;++t){e.getData()[t].FLAGCONT=false;e.getData()[t].CONTINTERVENTO=0;if(e.getData()[t].CHIAMATODA===undefined||e.getData()[t].CHIAMATODA===null){e.getData()[t].CHIAMATODA=""}if(e.getData()[t].CAUSA===undefined||e.getData()[t].CAUSA===null){e.getData()[t].CAUSA=""}else{e.getData()[t].CAUSA=e.getData()[t].CAUSA.trim()}}},checkForRIP:function(e,i){var r=0;var a;var n;var l;var o;this.resetContinterventoFlagCountChiamatoda(e);var s=this.getView().getModel("ParamSetModel").getData();if(this.getOwnerComponent().getModel("viewProperties").getProperty("/paramSet")===undefined){o=jQuery.grep(s,function(e){return e.PARAMETER_NAME=="INT_A_CAVALLO_MINUTI"});this.getOwnerComponent().getModel("viewProperties").setProperty("/paramSet",o)}else{o=this.getOwnerComponent().getModel("viewProperties").getProperty("/paramSet")}if(e.getData().length>o[0].PARAMETER_VALUE){for(var I=0;I<e.getData().length;++I){if(e.getData().length===1||I===e.getData().length-1){break}r=I+1;a=e.getData()[I].DATAINTERVENTO;n=new Date(t.formatDateToMMDDYYYY(a));l=new Date(t.formatDateToMMDDYYYY(a));l.setDate(n.getDate()+1);if(new Date(t.formatDateToMMDDYYYY(e.getData()[r].DATAINTERVENTO)).toString()===l.toString()){if(e.getData()[I].MINDIFFORAINIFINE>=1&&e.getData()[I].CHIAMATODA===e.getData()[r].CHIAMATODA&&e.getData()[I].CAUSA.toString()===e.getData()[r].CAUSA.toString()&&(e.getData()[I].ORAFINE==="08:30"&&e.getData()[I].ORAFINE.toString()===e.getData()[r].ORAINIZIO.toString())){e.getData()[I].CONTINTERVENTO=e.getData()[r].IDINTERVENTO;e.getData()[r].FLAGCONT=true;this.updateCompensativiPostRIPCheck(e.getData(),i)}else{e.getData()[r].FLAGCONT=false;e.getData()[I].CONTINTERVENTO=0}}}}},checkForRIPAfterSubmitForCONTINTERVENTO:function(e){console.log("Inside checkForRIPAfterSubmitForCONTINTERVENTO");var i=0;var r;var a;var n;var l;this.resetContinterventoFlagCountChiamatoda(e);var o=this.getView().getModel("ParamSetModel").getData();if(this.getOwnerComponent().getModel("viewProperties").getProperty("/paramSet")===undefined){l=jQuery.grep(o,function(e){return e.PARAMETER_NAME=="INT_A_CAVALLO_MINUTI"});this.getOwnerComponent().getModel("viewProperties").setProperty("/paramSet",l)}else{l=this.getOwnerComponent().getModel("viewProperties").getProperty("/paramSet")}if(e.getData().length>l[0].PARAMETER_VALUE){for(var s=0;s<e.getData().length;++s){if(e.getData().length===1||s===e.getData().length-1){break}i=s+1;r=e.getData()[s].DATAINTERVENTO;a=new Date(t.formatDateToMMDDYYYY(r));n=new Date(t.formatDateToMMDDYYYY(r));n.setDate(a.getDate()+1);if(new Date(t.formatDateToMMDDYYYY(e.getData()[i].DATAINTERVENTO)).toString()===n.toString()){if(e.getData()[s].MINDIFFORAINIFINE>1&&e.getData()[s].CHIAMATODA===e.getData()[i].CHIAMATODA&&e.getData()[s].CAUSA.toString()===e.getData()[i].CAUSA.toString()&&(e.getData()[s].ORAFINE==="08:30"&&e.getData()[s].ORAFINE.toString()===e.getData()[i].ORAINIZIO.toString())){e.getData()[s].CONTINTERVENTO=e.getData()[i].IDINTERVENTO;e.getData()[i].FLAGCONT=true}else{e.getData()[i].FLAGCONT=false;e.getData()[s].CONTINTERVENTO=0}}}}},updateCompensativiPostRIPCheck:function(e,i){var r=this;var a=false;r.RIPFLAG=false;var n;var l;var o;var s;var I;var T;var A;var g;var g;var O;var N;var E;var u;var d;var R;var D;var f;var p;var h;var M=0;var v=0;var m=false;var V=false;var S;var c;var P;var b;var C=r.getOwnerComponent().getModel("viewProperties").getProperty("/oRiposiWorkingDay");var w=r.getOwnerComponent().getModel("viewProperties").getProperty("/oRiposiNonWorkingDay");var L=r.getView().getModel("RegoleCompensativi").getData();var F=$.unique(e.map(function(e){return e.DATAINTERVENTO}));var y=0;var Y=0;var _=0;var G=0;var H=0;var U=0;var x=0;var Z=0;F.map(function(i){y=0;Y=0;_=0;G=0;H=0;U=0;x=0;m=false;V=false;var N=[];var E={};var u={};var d=0;var R;var D;var f;if(e.length>1){for(var p=0;p<e.length;++p){if(e.length===1||p===e.length-1){R=e[p].DATAINTERVENTO;D=new Date(t.formatDateToMMDDYYYY(R));f=new Date(t.formatDateToMMDDYYYY(R));f.setDate(D.getDate()+1);if(e[p].DATAINTERVENTO===i&&e[p].CHECKOK==="Y"&&!e[p].FLAGCONT){r.getLSFForMultiCalc(t.formatDateMulti(f));if(!r.LSFHolidayFlag){n=e[p].ORAINIZIOTIMESTAMP;l=e[p].ORAFINETIMESTAMP;S=new Date(t.formatDateToMMDDYYYY(e[p].DATAINTERVENTO));c=new Date(t.formatDateToMMDDYYYY(e[p].DATAINTERVENTO));c.setDate(D.getDate()+1);P=new Date(S.getFullYear(),S.getMonth(),S.getDate(),"23","00","00");b=new Date(c.getFullYear(),c.getMonth(),c.getDate(),"08","30","00");if(n>=P&&n<=b&&l>=P&&l<=b){x=x+1}}}break}d=p+1;R=e[p].DATAINTERVENTO;D=new Date(t.formatDateToMMDDYYYY(R));f=new Date(t.formatDateToMMDDYYYY(R));f.setDate(D.getDate()+1);if(e[p].DATAINTERVENTO===i&&e[p].CHECKOK==="Y"&&!e[p].FLAGCONT){r.getLSFForMultiCalc(t.formatDateMulti(f));if(!r.LSFHolidayFlag){n=e[p].ORAINIZIOTIMESTAMP;l=e[p].ORAFINETIMESTAMP;S=new Date(t.formatDateToMMDDYYYY(e[p].DATAINTERVENTO));c=new Date(t.formatDateToMMDDYYYY(e[p].DATAINTERVENTO));c.setDate(D.getDate()+1);P=new Date(S.getFullYear(),S.getMonth(),S.getDate(),"23","00","00");b=new Date(c.getFullYear(),c.getMonth(),c.getDate(),"08","30","00");if(n>=P&&n<=b&&l>=P&&l<=b){x=x+1}}}if(new Date(t.formatDateToMMDDYYYY(e[d].DATAINTERVENTO)).toString()===f.toString()&&e[d].FLAGCONT){r.getLSFForMultiCalc(t.formatDateMulti(f));if(!r.LSFHolidayFlag){n=e[d].ORAINIZIOTIMESTAMP;l=e[d].ORAFINETIMESTAMP;S=new Date(t.formatDateToMMDDYYYY(e[d].DATAINTERVENTO));c=new Date(t.formatDateToMMDDYYYY(e[d].DATAINTERVENTO));c.setDate(D.getDate()+1);P=new Date(S.getFullYear(),S.getMonth(),S.getDate(),"23","00","00");b=new Date(c.getFullYear(),c.getMonth(),c.getDate(),"08","30","00");if(n>=P&&n<=b&&l>=P&&l<=b){x=x+1}}}}}for(var h=0;h<L.length;h++){if(x>=L[0].N_INTERVENTI){Z=L[0].VALORE}}for(var p=0;p<e.length;++p){if(e.length===1||p===e.length-1){break}d=p+1;R=e[p].DATAINTERVENTO;D=new Date(t.formatDateToMMDDYYYY(R));f=new Date(t.formatDateToMMDDYYYY(R));f.setDate(D.getDate()+1);if(e[p].DATAINTERVENTO===i){if(e[p].WORKINGDAY){m=true;y=0;G=0;H=0;$.each(e,function(e,r){if(r.DATAINTERVENTO.toString()===i.toString()&&r.CHECKOK==="Y"&&!r.FLAGCONT){n=r.ORAINIZIOTIMESTAMP;l=r.ORAFINETIMESTAMP;o=new Date(t.formatDateToMMDDYYYY(r.DATAINTERVENTO));s=new Date(t.formatDateToMMDDYYYY(r.DATAINTERVENTO));o=new Date(t.formatDateToMMDDYYYY(r.DATAINTERVENTO));g=new Date(t.formatDateToMMDDYYYY(r.DATAINTERVENTO));g.setDate(o.getDate()+1);T=new Date(s.getFullYear(),s.getMonth(),s.getDate(),"22","00","00");O=new Date(g.getFullYear(),g.getMonth(),g.getDate(),"08","30","00");if(n>=T&&n<=O&&l>=T&&l<=O){y=y+r.MINDIFFORAINIFINE}else{if(n<T&&(l>T&&l<=O)){y=y+r.MINDIFFORAINIFINE}}}});if(new Date(t.formatDateToMMDDYYYY(e[d].DATAINTERVENTO)).toString()===f.toString()&&e[d].FLAGCONT){r.RIPFLAG=true;y=y+e[d].MINDIFFORAINIFINE}for(var d=0;d<C.length;++d){if(C[d].DURATA_MIN<y&&y<=C[d].DURATA_MAX){n=e[p].ORAINIZIOTIMESTAMP;l=e[p].ORAFINETIMESTAMP;o=new Date(t.formatDateToMMDDYYYY(e[p].DATAINTERVENTO));g.setDate(o.getDate()+1);T=new Date(o.getFullYear(),o.getMonth(),o.getDate(),"22","00","00");O=new Date(g.getFullYear(),g.getMonth(),g.getDate(),"08","30","00");if(n>=T&&n<=O&&l>T&&l<=O){if(x<3){E={InterventiDate:i,RiposiValue:(C[d].VALORE*8).toString()+"H",multi:"("+0+" Multi)"}}else{E={InterventiDate:i,RiposiValue:(C[d].VALORE*8).toString()+"H",multi:"("+Z.toString()+" Multi)"}}N.push(E);E={};a=true;break}else{if(n<T&&(l>T&&l<=O)){if(x<3){E={InterventiDate:i,RiposiValue:(C[d].VALORE*8).toString()+"H",multi:"("+0+" Multi)"}}else{E={InterventiDate:i,RiposiValue:(C[d].VALORE*8).toString()+"H",multi:"("+Z.toString()+" Multi)"}}N.push(E);E={};a=true;break}}}}}else{V=true;Y=0;_=0;U=0;$.each(e,function(e,r){if(r.DATAINTERVENTO.toString()===i.toString()&&r.CHECKOK==="Y"&&!r.FLAGCONT){n=r.ORAINIZIOTIMESTAMP;l=r.ORAFINETIMESTAMP;o=new Date(t.formatDateToMMDDYYYY(r.DATAINTERVENTO));s=new Date(t.formatDateToMMDDYYYY(r.DATAINTERVENTO));I=new Date(o);T=new Date(s.getFullYear(),s.getMonth(),s.getDate(),"08","30","00");A=new Date(I.getFullYear(),I.getMonth(),I.getDate(),"22","00","00");if(n>=T&&n<=A&&l>=T&&l<=A){Y=Y+r.MINDIFFORAINIFINE}o=new Date(t.formatDateToMMDDYYYY(r.DATAINTERVENTO));g=new Date(t.formatDateToMMDDYYYY(r.DATAINTERVENTO));g.setDate(o.getDate()+1);T=new Date(s.getFullYear(),s.getMonth(),s.getDate(),"22","00","00");O=new Date(g.getFullYear(),g.getMonth(),g.getDate(),"08","30","00");if(n<T&&(l>=T&&l<=O)){_=_+r.MINDIFFORAINIFINE}else if(n>=T&&n<=O&&l>=T&&l<=O){_=_+r.MINDIFFORAINIFINE}}});if(new Date(t.formatDateToMMDDYYYY(e[d].DATAINTERVENTO)).toString()===f.toString()&&e[d].FLAGCONT){r.RIPFLAG=true;Y=Y+e[d].MINDIFFORAINIFINE}for(var d=0;d<w.length;++d){if(w[d].DURATA_MIN===240&&w[d].DURATA_MAX===480||w[d].DURATA_MIN===480&&w[d].DURATA_MAX===1440){if(w[d].DURATA_MIN<Y&&Y<=w[d].DURATA_MAX){n=e[p].ORAINIZIOTIMESTAMP;l=e[p].ORAFINETIMESTAMP;o=new Date(t.formatDateToMMDDYYYY(e[p].DATAINTERVENTO));s=new Date(t.formatDateToMMDDYYYY(e[p].DATAINTERVENTO));I=new Date(o);T=new Date(s.getFullYear(),s.getMonth(),s.getDate(),"08","30","00");A=new Date(I.getFullYear(),I.getMonth(),I.getDate(),"22","00","00");if(n>=T&&n<=A&&l>=T&&l<=A){if(x<3){E={InterventiDate:i,RiposiValue:(w[d].VALORE*8).toString()+"H",multi:"("+0+" Multi)"}}else{E={InterventiDate:i,RiposiValue:(w[d].VALORE*8).toString()+"H",multi:"("+Z.toString()+" Multi)"}}N.push(E);E={};a=true;break}else if(n<T&&(l>=T&&l<=O)){if(x<3){E={InterventiDate:i,RiposiValue:(w[d].VALORE*8).toString()+"H",multi:"("+0+" Multi)"}}else{E={InterventiDate:i,RiposiValue:(w[d].VALORE*8).toString()+"H",multi:"("+Z.toString()+" Multi)"}}N.push(E);E={};a=true;break}}}else{if(w[d].DURATA_MIN===60&&w[d].DURATA_MAX===120||w[d].DURATA_MIN===120&&w[d].DURATA_MAX===240||w[d].DURATA_MIN===240&&w[d].DURATA_MAX===1440){if(w[d].DURATA_MIN<_&&_<=w[d].DURATA_MAX){n=e[p].ORAINIZIOTIMESTAMP;l=e[p].ORAFINETIMESTAMP;o=new Date(t.formatDateToMMDDYYYY(e[p].DATAINTERVENTO));g=new Date(t.formatDateToMMDDYYYY(e[p].DATAINTERVENTO));g.setDate(o.getDate()+1);T=new Date(o.getFullYear(),o.getMonth(),o.getDate(),"22","00","00");O=new Date(g.getFullYear(),g.getMonth(),g.getDate(),"08","30","00");if(n>=T&&n<=O&&l>=T&&l<=O){if(x<3){E={InterventiDate:i,RiposiValue:(w[d].VALORE*8).toString()+"H",multi:"("+0+" Multi)"}}else{E={InterventiDate:i,RiposiValue:(w[d].VALORE*8).toString()+"H",multi:"("+Z.toString()+" Multi)"}}N.push(E);E={};a=true;break}}}}}}}}var F=[];if(V){if(N.length>0){F.push(N[N.length-1]);if(Y!==0&&_===0){if(N[0].RiposiValue!==""&&N[0].RiposiValue!==undefined&&N[0].RiposiValue!==null){v=N[0].RiposiValue;M=parseInt(v.substr(0,v.indexOf("H")))}}else if(_!==0&&Y===0){if(N[0].RiposiValue!==""&&N[0].RiposiValue!==undefined&&N[0].RiposiValue!==null){v=N[0].RiposiValue;M=parseInt(v.substr(0,v.indexOf("H")))}}else{for(var p=0;p<N.length;++p){if(N.length==1){if(N[p].RiposiValue!==""&&N[p].RiposiValue!==undefined&&N[p].RiposiValue!==null){v=N[p].RiposiValue;M=parseInt(v.substr(0,v.indexOf("H")))}else{M=0}}else{if(N[p].RiposiValue!==""&&N[p].RiposiValue!==undefined&&N[p].RiposiValue!==null){v=N[p].RiposiValue;M=M+parseInt(v.substr(0,v.indexOf("H")))}}}}if(M>8){M=8}F[0].RiposiValue=M+"H"}}else if(m&&r.RIPFLAG){if(N.length>0){F.push(N[N.length-1])}}else if(m&&!r.RIPFLAG){if(N.length>0){F=r.unique(N)}}var B=r.getView().byId("idTableInterventi").getModel("RepintInterventiModel");for(var K=0;K<e.length;++K){for(var k=0;k<F.length;++k){if(e[K].DATAINTERVENTO===F[k].InterventiDate){B.getData()[K].RIPOSI=F[k].RiposiValue+" "+F[k].multi;F.splice(0,1);break}}}B.updateBindings(true)})},setStessacausaleToZeroForAllInterventiRec:function(e){for(var t=0;t<e.length;++t){e[t].STESSACAUSALE=0}},setStessacausale:function(e){var t=0;var i=0;var r=0;var a;var n=$.unique(e.getData().map(function(e){return e.DATAINTERVENTO}));var l=e.getData();this.setStessacausaleToZeroForAllInterventiRec(l);n.map(function(e){a=jQuery.grep(l,function(t){return t.DATAINTERVENTO==e});for(var n=0;n<a.length;++n){if(a.length===1){a[0].STESSACAUSALE=0;break}else if(n===a.length-1){break}t=n+1;a[t].STESSACAUSALE=a[0].IDINTERVENTO}for(var o=r;o<l.length;++o){if(l[o].DATAINTERVENTO===e){for(var s=0;s<a.length;++s){i=o+s;l[i]=a[s];r=i+1}}break}});console.log("********** SET STESSACAUSALE *********");console.log(l);this.setStessacausaleForRIP(n,l)},setStessacausaleForRIP:function(e,t){var i=[];var r;var a=0;var n=0;var l=0;e.map(function(e){r=jQuery.grep(t,function(t){return t.DATAINTERVENTO==e});i.push(r[0])});for(var o=0;o<i.length;++o){if(i.length===1){i[0].STESSACAUSALE=0;break}else if(o===i.length-1){break}a=o+1;if(i[a].FLAGCONT){i[a].STESSACAUSALE=i[o].IDINTERVENTO}}for(var s=0;s<t.length;++s){for(var a=0;a<i.length;++a){if(t[s].DATAINTERVENTO===i[a].DATAINTERVENTO){t[s]=i[a];i.splice(a,1);break}}}console.log("********** SET STESSACAUSALE FOR RIP *********");console.log(t);this.calcTotGioRipCompIntDett(t)},calcTotGioRipCompIntDett:function(e){var t="";var i=0;var r;this.TOTALE_GIORNI_RIPOSI_COMPENSATIVI=this.getOwnerComponent().getModel("viewProperties").getProperty("/TOTALE_GIORNI_RIPOSI_COMPENSATIVI");for(var a=0;a<e.length;++a){if(e.length==1){if(e[a].RIPOSI!==""&&e[a].RIPOSI!==undefined&&e[a].RIPOSI!==null){r=e[a].RIPOSI;i=parseInt(r.substr(0,r.indexOf("H")))}else{i=0}t=e[a].IDINTERVENTO.toString()}else{if(e[a].RIPOSI!==""&&e[a].RIPOSI!==undefined&&e[a].RIPOSI!==null){r=e[a].RIPOSI;i=i+parseInt(r.substr(0,r.indexOf("H")))}if(a===e.length-1){t=t+e[a].IDINTERVENTO.toString()}else{t=t+e[a].IDINTERVENTO.toString()+","}}}for(var n=0;n<e.length;++n){e[n].TOTALE_GIORNI_RIPOSI_COMPENSATIVI=i/8;e[n].INTERVENTI_DETTAGLIO=t}this.TOTALE_GIORNI_RIPOSI_COMPENSATIVI=i/8;this.getOwnerComponent().getModel("viewProperties").setProperty("/TOTALE_GIORNI_RIPOSI_COMPENSATIVI",this.TOTALE_GIORNI_RIPOSI_COMPENSATIVI);console.log("********** calcTotGioRipCompIntDett *********");console.log(e);this.handleCreateAfterSubmit(e)},handleInterDateLPNChange:function(e){var t=this.getView().byId("idTableReperibilita").getModel("RepintReperibilitaModel");var r=this.getView().byId("idTableInterventi").getModel("RepintInterventiModel");var a=e.getSource().getParent().getParent().indexOfItem(e.getSource().getParent());var n=this.getView().byId("idTableInterventi");var l=false;for(var o=0;o<t.getData().length;++o){if(r.getData()[a].DATAINTERVENTO===t.getData()[o].DATAREPERIBILITA){l=true}}if(l&&r.getData()[a].FLAGNOTTURNO===true&&(r.getData()[a].DATAINTERVENTO!==""&&r.getData()[a].DATAINTERVENTO!==undefined&&r.getData()[a].DATAINTERVENTO!==null)){r.getData()[a].DATAINTERVENTO=null;r.updateBindings(true);n.getItems()[a].getCells()[2].setValueState(sap.ui.core.ValueState.Error);i.error("La data di Intervento selezionata non deve essere uguale a nessuna data di ripetibilità inserita");return false}else{n.getItems()[a].getCells()[2].setValueState(sap.ui.core.ValueState.None)}if(!l&&r.getData()[a].FLAGNOTTURNO!==true&&(r.getData()[a].DATAINTERVENTO!==""&&r.getData()[a].DATAINTERVENTO!==undefined&&r.getData()[a].DATAINTERVENTO!==null)){r.getData()[a].DATAINTERVENTO=null;r.updateBindings(true);n.getItems()[a].getCells()[2].setValueState(sap.ui.core.ValueState.Error);return false}else{n.getItems()[a].getCells()[2].setValueState(sap.ui.core.ValueState.None)}return true},onAddItems1:function(){var e=this.getView().byId("idTableReperibilita").getModel("RepintReperibilitaModel").getProperty("/");var t=new Date(this.getOwnerComponent().getModel("viewProperties").getProperty("/ANNOMESE"));var i=new Date(t.getFullYear(),t.getMonth(),1);var r=new Date(t.getFullYear(),t.getMonth()+1,0);if(e.length===1){e[0].oButton2=true}var a={IDSCHEDA:"",DATAREPERIBILITA:"",IDREPERIBILITA:"",Fer:false,Sab:false,Dom:false,minDate:i,maxDate:r,oButton1:true,oButton2:true};e.push(a);this.getView().byId("idTableReperibilita").getModel("RepintReperibilitaModel").setProperty("/",e);this.getView().byId("txtAggiorna").setText(e.length);this.getView().byId("txtElimina").setText(e.length)},onAddItems1New:function(){var e=[];if(this.getView().byId("idTableReperibilita").getModel("RepintReperibilitaModel")===undefined||this.getView().byId("idTableReperibilita").getModel("RepintReperibilitaModel")===null||this.getView().byId("idTableReperibilita").getModel("RepintReperibilitaModel").getData()===null||this.getView().byId("idTableReperibilita").getModel("RepintReperibilitaModel").getData()===undefined){e=[]}else{e=this.getView().byId("idTableReperibilita").getModel("RepintReperibilitaModel").getProperty("/")}var t=new Date(this.getOwnerComponent().getModel("viewProperties").getProperty("/ANNOMESE"));var i=new Date(t.getFullYear(),t.getMonth(),1);var r=new Date(t.getFullYear(),t.getMonth()+1,0);var a={IDSCHEDA:"",DATAREPERIBILITA:"",IDREPERIBILITA:"",Fer:false,Sab:false,Dom:false,minDate:i,maxDate:r,oButton1:true,oButton2:false};e.push(a);if(this.getView().byId("idTableReperibilita").getModel("RepintReperibilitaModel")===undefined||this.getView().byId("idTableReperibilita").getModel("RepintReperibilitaModel").getData()===null){var n=new sap.ui.model.json.JSONModel;n.setData(e);this.getView().byId("idTableReperibilita").setModel(n,"RepintReperibilitaModel")}else{this.getView().byId("idTableReperibilita").getModel("RepintReperibilitaModel").setProperty("/",e)}this.getView().byId("txtAggiorna").setText(e.length);this.getView().byId("txtElimina").setText(e.length)},onDeleteCategory1:function(e){var t=this.getView().byId("idTableReperibilita").getModel("RepintReperibilitaModel").getProperty("/");var i=this.getView().byId("idTableInterventi").getModel("RepintInterventiModel").getProperty("/");var r=e.getSource().getParent().getParent().indexOfItem(e.getSource().getParent());var a=i.length;while(a--){if(t[r].DATAREPERIBILITA===i[a].DATAINTERVENTO){i.splice(a,1)}}console.log(i);t.splice(r,1);this.chkFer(false);this.chkSab(false);this.chkDom(false);this.getView().byId("idTableReperibilita").getModel("RepintReperibilitaModel").setProperty("/",t);this.getView().byId("txtAggiorna").setText(t.length);this.getView().byId("txtElimina").setText(t.length);if(t.length===0){this.getView().byId("txtAggiorna1").setText(1);this.getView().byId("txtElimina1").setText(1)}else{this.getView().byId("idTableInterventi").getModel("RepintInterventiModel").setProperty("/",i);this.getView().byId("txtAggiorna1").setText(t.length);this.getView().byId("txtElimina1").setText(t.length)}if(t.length===0){this.onAddItems1New()}if(i.length===0){this.chk1h(false);this.chk12h(false);this.chk24h(false);this.chk46h(false);this.chk68h(false);this.chk8h(false);this.onAddItems2New()}},onAddItems2:function(){var e=this.getView().byId("idTableInterventi").getModel("RepintInterventiModel").getProperty("/");var t=new Date(this.getOwnerComponent().getModel("viewProperties").getProperty("/ANNOMESE"));var i=new Date(t.getFullYear(),t.getMonth(),1);var r=new Date(t.getFullYear(),t.getMonth()+1,0);if(e.length===1){e[0].oButton2=true}var a={n:e.length+1,CAUSA:"",h1h:false,h12h:false,h24h:false,h46h:false,h68h:false,h8h:false,oButton1:true,oButton2:true,minDate:i,maxDate:r,DATAINTERVENTO:"",FASCIA:0,STESSACAUSALE:0,DURATA:0,CONTINTERVENTO:0,FLAGNOTTURNO:false,FLAGCONT:false,ORAFINE:"",ORAINIZIO:"",IDINTERVENTO:"",IDSCHEDA:"",WORKINGDAY:"",NONWORKINGDAY:"",MINDIFFORAINIFINE:"",ORAINIZIOTIMESTAMP:"",ORAFINETIMESTAMP:"",CHECKOK:"",RIPOSI:"",CHIAMATODA_ALTRO:"",CHIAMATODA:""};e.push(a);this.getView().byId("idTableInterventi").getModel("RepintInterventiModel").setProperty("/",e);this.getView().byId("txtAggiorna1").setText(e.length);this.getView().byId("txtElimina1").setText(e.length)},onAddItems2New:function(){var e=[];if(this.getView().byId("idTableInterventi").getModel("RepintInterventiModel")===undefined||this.getView().byId("idTableInterventi").getModel("RepintInterventiModel")===null||this.getView().byId("idTableInterventi").getModel("RepintInterventiModel").getData()===null||this.getView().byId("idTableInterventi").getModel("RepintInterventiModel").getData()===undefined){e=[]}else{e=this.getView().byId("idTableInterventi").getModel("RepintInterventiModel").getProperty("/")}var t=new Date(this.getOwnerComponent().getModel("viewProperties").getProperty("/ANNOMESE"));var i=new Date(t.getFullYear(),t.getMonth(),1);var r=new Date(t.getFullYear(),t.getMonth()+1,0);var a={n:e.length+1,CAUSA:"",h1h:false,h12h:false,h24h:false,h46h:false,h68h:false,h8h:false,oButton1:true,oButton2:false,minDate:i,maxDate:r,DATAINTERVENTO:"",FASCIA:0,STESSACAUSALE:0,DURATA:0,CONTINTERVENTO:0,FLAGNOTTURNO:false,FLAGCONT:false,ORAFINE:"",ORAINIZIO:"",IDINTERVENTO:"",IDSCHEDA:"",WORKINGDAY:"",NONWORKINGDAY:"",MINDIFFORAINIFINE:"",ORAINIZIOTIMESTAMP:"",ORAFINETIMESTAMP:"",CHECKOK:"",RIPOSI:"",CHIAMATODA_ALTRO:"",CHIAMATODA:""};e.push(a);if(this.getView().byId("idTableInterventi").getModel("RepintInterventiModel")===undefined||this.getView().byId("idTableInterventi").getModel("RepintInterventiModel").getData()===null){var n=new sap.ui.model.json.JSONModel;n.setData(e);this.getView().byId("idTableInterventi").setModel(n,"RepintInterventiModel")}else{this.getView().byId("idTableInterventi").getModel("RepintInterventiModel").setProperty("/",e)}this.getView().byId("txtAggiorna1").setText(e.length);this.getView().byId("txtElimina1").setText(e.length)},onDeleteCategory2:function(e){var t=this.getView().byId("idTableInterventi").getModel("RepintInterventiModel").getProperty("/");var i=e.getSource().getParent().getParent().indexOfItem(e.getSource().getParent());var r=this.getView().byId("idTableReperibilita").getModel("RepintReperibilitaModel");var a=this.getView().byId("idTableInterventi").getModel("RepintInterventiModel");var n=this.getView().byId("idTableInterventi");n.getItems()[i].getCells()[3].setValueState(sap.ui.core.ValueState.None);t.splice(i,1);if(t.length===1){t[0].bDelete=false;t[0].bAdd=true}this.getView().byId("idTableInterventi").getModel("RepintInterventiModel").setProperty("/",t);this.getView().byId("txtAggiorna1").setText(t.length);this.getView().byId("txtElimina1").setText(t.length);if(t.length===0){this.chk1h(false);this.chk12h(false);this.chk24h(false);this.chk46h(false);this.chk68h(false);this.chk8h(false);this.onAddItems2New()}else{this.filterRiposiSet(this.getView().byId("idTableInterventi"),r,a,i,false)}},chkFer:function(e){var t=this.getView().byId("idTableReperibilita").getModel("RepintReperibilitaModel").getProperty("/");var i=0;if(e){for(var r=0;r<t.length;r++){if(t[r].Fer==true){i=i+1}}this.getView().byId("txtFer").setText(i)}else{i=t.length;for(var r=0;r<t.length;r++){if(t[r].Fer==false){i=i-1}}this.getView().byId("txtFer").setText(i)}},chkSab:function(e){var t=this.getView().byId("idTableReperibilita").getModel("RepintReperibilitaModel").getProperty("/");var i=0;if(e){for(var r=0;r<t.length;r++){if(t[r].Sab==true){i=i+1}}this.getView().byId("txtSab").setText(i)}else{i=t.length;for(var r=0;r<t.length;r++){if(t[r].Sab==false){i=i-1}}this.getView().byId("txtSab").setText(i)}},chkDom:function(e){var t=this.getView().byId("idTableReperibilita").getModel("RepintReperibilitaModel").getProperty("/");var i=0;if(e){for(var r=0;r<t.length;r++){if(t[r].Dom==true){i=i+1}}this.getView().byId("txtDom").setText(i)}else{i=t.length;for(var r=0;r<t.length;r++){if(t[r].Dom==false){i=i-1}}this.getView().byId("txtDom").setText(i)}},chk1h:function(e){var t=this.getView().byId("idTableInterventi").getModel("RepintInterventiModel").getProperty("/");var i=0;if(e){for(var r=0;r<t.length;r++){if(t[r].h1h===true){i=i+1}}this.getView().byId("txt1h").setText(i)}else{i=t.length;for(var r=0;r<t.length;r++){if(t[r].h1h===false){i=i-1}}this.getView().byId("txt1h").setText(i)}},chk12h:function(e){var t=this.getView().byId("idTableInterventi").getModel("RepintInterventiModel").getProperty("/");var i=0;if(e){for(var r=0;r<t.length;r++){if(t[r].h12h===true){i=i+1}}this.getView().byId("txt12h").setText(i)}else{i=t.length;for(var r=0;r<t.length;r++){if(t[r].h12h===false){i=i-1}}this.getView().byId("txt12h").setText(i)}},chk24h:function(e){var t=this.getView().byId("idTableInterventi").getModel("RepintInterventiModel").getProperty("/");var i=0;if(e){for(var r=0;r<t.length;r++){if(t[r].h24h===true){i=i+1}}this.getView().byId("txt24h").setText(i)}else{i=t.length;for(var r=0;r<t.length;r++){if(t[r].h24h===false){i=i-1}}this.getView().byId("txt24h").setText(i)}},chk46h:function(e){var t=this.getView().byId("idTableInterventi").getModel("RepintInterventiModel").getProperty("/");var i=0;if(e){for(var r=0;r<t.length;r++){if(t[r].h46h===true){i=i+1}}this.getView().byId("txt46h").setText(i)}else{i=t.length;for(var r=0;r<t.length;r++){if(t[r].h46h===false){i=i-1}}this.getView().byId("txt46h").setText(i)}},chk68h:function(e){var t=this.getView().byId("idTableInterventi").getModel("RepintInterventiModel").getProperty("/");var i=0;if(e){for(var r=0;r<t.length;r++){if(t[r].h68h===true){i=i+1}}this.getView().byId("txt68h").setText(i)}else{i=t.length;for(var r=0;r<t.length;r++){if(t[r].h68h===false){i=i-1}}this.getView().byId("txt68h").setText(i)}},chk8h:function(e){var t=this.getView().byId("idTableInterventi").getModel("RepintInterventiModel").getProperty("/");var i=0;if(e){for(var r=0;r<t.length;r++){if(t[r].h8h===true){i=i+1}}this.getView().byId("txt8h").setText(i)}else{i=t.length;for(var r=0;r<t.length;r++){if(t[r].h8h===false){i=i-1}}this.getView().byId("txt8h").setText(i)}},handleAnnoMese:function(e){var r=this;r.invioBozzaFlag=false;r.invioFlag=false;r.getView().byId("idScheda").setText("");r.getView().byId("idApprovazione1").setText("");r.getView().byId("idApprovazione2").setText("");r.getView().byId("idApprovazione3").setText("");r.getView().byId("idRepintCambioResp").setValue("");r.getView().byId("txt1h").setText(0);r.getView().byId("txt12h").setText(0);r.getView().byId("txt24h").setText(0);r.getView().byId("txt46h").setText(0);r.getView().byId("txt68h").setText(0);r.getView().byId("txt8h").setText(0);r.getView().byId("txtFer").setText(0);r.getView().byId("txtSab").setText(0);r.getView().byId("txtDom").setText(0);var a=r.getView().byId("idTableReperibilita").getModel("RepintReperibilitaModel");if(a!==undefined&&a!==null&&a!==""){if(a.getProperty("/")!==null&&a.getProperty("/")!==undefined&&a.getProperty("/")!==""){var n=a.getProperty("/");var l=a.getData().length;while(l--){n.splice(l,1)}if(a){r.getView().byId("txtAggiorna").setText(0);r.getView().byId("txtElimina").setText(0);r.getView().byId("idTableReperibilita").removeAllItems();a.destroy();a.setData(null);a.updateBindings(true)}}}else{r.getView().byId("txtAggiorna").setText(0);r.getView().byId("txtElimina").setText(0)}var o=r.getView().byId("idTableInterventi").getModel("RepintInterventiModel");if(o!==undefined&&o!==null&&o!==""){if(o.getProperty("/")!==null&&o.getProperty("/")!==undefined&&o.getProperty("/")!==""){var s=o.getProperty("/");var I=o.getData().length;while(I--){s.splice(I,1)}if(o){this.getView().byId("txtAggiorna1").setText(0);this.getView().byId("txtElimina1").setText(0);r.getView().byId("idTableInterventi").removeAllItems();o.destroy();o.setData(null);o.updateBindings(true)}}}else{this.getView().byId("txtAggiorna1").setText(1);this.getView().byId("txtElimina1").setText(1)}if(e.getSource().getDateValue()===null||e.getSource().getDateValue()===undefined||e.getSource().getDateValue()===""){i.error("Il campo Mese/Anno deve essere valorizzato");return}else{r.getView().byId("dpAnnoMese").setValue(t.formatMeseAnno(e.getSource().getDateValue()));r.getOwnerComponent().getModel("viewProperties").setProperty("/ANNOMESE",r.getView().byId("dpAnnoMese").getValue());var T=r.getOwnerComponent().getModel("basexsoModel");r.getEmpData(T)}},tpChange1:function(e){var r=e.getSource(),a=e.getParameter("value"),n=e.getParameter("valid");var l=this.getView().byId("idTableReperibilita").getModel("RepintReperibilitaModel");var o=this.getView().byId("idTableInterventi").getModel("RepintInterventiModel");var I=e.getSource().getParent().getParent().indexOfItem(e.getSource().getParent());var T=a;var A=o.getData()[I].ORAFINE;var g=o.getData()[I].DATAINTERVENTO;var O;var N;var E;var u;var d;var R;var D;var f;var p;var h=false;o.getData()[I].FLAGCONT=false;o.getData()[I].RIPOSI=null;if(g===""||g===undefined||g===null){if(this.getView().byId("idTableReperibilita").getItems()[I]!==undefined){this.getView().byId("idTableReperibilita").getItems()[I].getCells()[2].setValueState(sap.ui.core.ValueState.Error)}i.error("Nella sezione Interventi valorizzata il campo data");return}for(var M=0;M<l.getData().length;++M){if(g===l.getData()[M].DATAREPERIBILITA||o.getData()[I].FLAGNOTTURNO){if(T===""||T===null){o.getData()[I].ORAINIZIOTIMESTAMP=null;r.setValueState(s.Error);i.error("Il campo Ora Inizio deve essere valorizzato");return}O=new Date(t.formatDateToMMDDYYYY(g));d=new Date(t.formatDateToMMDDYYYY(g));E=O.getFullYear();N=O.getMonth();u=O.getDate();d.setDate(O.getDate()+1);R=d.getFullYear();D=d.getMonth();f=d.getDate();if(o.getData()[I].FLAGNOTTURNO){if(this.getTimeAsNumberOfMinutes(T)<this.getTimeAsNumberOfMinutes("17:30")&&this.getTimeAsNumberOfMinutes(T)>this.getTimeAsNumberOfMinutes("08:30")){o.getData()[I].ORAINIZIO=null;o.getData()[I].ORAINIZIOTIMESTAMP=null;r.setValueState(s.Error);i.error("Occorre inserire delle ore comprese nella fascia oraria 17:30 – 08:30");return}if(A!==""&&A!==null){if(this.getTimeAsNumberOfMinutes(T)>this.getTimeAsNumberOfMinutes("08:30")&&this.getTimeAsNumberOfMinutes(T)<this.getTimeAsNumberOfMinutes("17:30")){o.getData()[I].ORAINIZIO=null;o.getData()[I].ORAINIZIOTIMESTAMP=null;r.setValueState(s.Error);i.error("Occorre inserire delle ore comprese nella fascia oraria 17:30 – 08:30");return}else{if(this.getTimeAsNumberOfMinutes(T)>=this.getTimeAsNumberOfMinutes("17:30")&&this.getTimeAsNumberOfMinutes(T)<=this.getTimeAsNumberOfMinutes("23:59")){p=new Date(E,N,u,T.split(":")[0],T.split(":")[1],"00");if(p>o.getData()[I].ORAFINETIMESTAMP){o.getData()[I].ORAINIZIO=null;o.getData()[I].ORAINIZIOTIMESTAMP=null;r.setValueState(s.Error);i.error('Il valore inserito in "Ora Inizio" non può essere maggiore di quello inserito in "Ora Fine" ');return}else{o.getData()[I].ORAINIZIOTIMESTAMP=p;h=true}}else if(this.getTimeAsNumberOfMinutes(T)>=this.getTimeAsNumberOfMinutes("00:00")&&this.getTimeAsNumberOfMinutes(T)<=this.getTimeAsNumberOfMinutes("08:30")){p=new Date(R,D,f,T.split(":")[0],T.split(":")[1],"00");if(p>o.getData()[I].ORAFINETIMESTAMP){o.getData()[I].ORAINIZIO=null;o.getData()[I].ORAINIZIOTIMESTAMP=null;r.setValueState(s.Error);i.error('Il valore inserito in "Ora Inizio" non può essere maggiore di quello inserito in "Ora Fine" ');return}else{o.getData()[I].ORAINIZIOTIMESTAMP=p;h=true}}}}else{if(this.getTimeAsNumberOfMinutes(T)>=this.getTimeAsNumberOfMinutes("17:30")&&this.getTimeAsNumberOfMinutes(T)<=this.getTimeAsNumberOfMinutes("23:59")){p=new Date(E,N,u,T.split(":")[0],T.split(":")[1],"00");o.getData()[I].ORAINIZIOTIMESTAMP=p;r.setValueState(s.None)}else if(this.getTimeAsNumberOfMinutes(T)>=this.getTimeAsNumberOfMinutes("00:00")&&this.getTimeAsNumberOfMinutes(T)<=this.getTimeAsNumberOfMinutes("08:30")){p=new Date(R,D,f,T.split(":")[0],T.split(":")[1],"00");o.getData()[I].ORAINIZIOTIMESTAMP=p;r.setValueState(s.None)}}}else{if(l.getData()[M].Fer){if(this.getTimeAsNumberOfMinutes(T)<this.getTimeAsNumberOfMinutes("17:30")&&this.getTimeAsNumberOfMinutes(T)>this.getTimeAsNumberOfMinutes("08:30")){o.getData()[I].ORAINIZIO=null;o.getData()[I].ORAINIZIOTIMESTAMP=null;r.setValueState(s.Error);i.error('Per i giorni lavorativi "Ora Inizio" deve essere compresa tra le 17:30 e le 08:30 del giorno successivo');return}if(A!==""&&A!==null){if(this.getTimeAsNumberOfMinutes(T)>this.getTimeAsNumberOfMinutes("08:30")&&this.getTimeAsNumberOfMinutes(T)<this.getTimeAsNumberOfMinutes("17:30")){o.getData()[I].ORAINIZIO=null;o.getData()[I].ORAINIZIOTIMESTAMP=null;r.setValueState(s.Error);i.error('Per i giorni lavorativi "Ora Inizio" deve essere compresa tra le 17:30 e le 08:30 del giorno successivo');return}else{if(this.getTimeAsNumberOfMinutes(T)>=this.getTimeAsNumberOfMinutes("17:30")&&this.getTimeAsNumberOfMinutes(T)<=this.getTimeAsNumberOfMinutes("23:59")){p=new Date(E,N,u,T.split(":")[0],T.split(":")[1],"00");if(p>o.getData()[I].ORAFINETIMESTAMP){o.getData()[I].ORAINIZIO=null;o.getData()[I].ORAINIZIOTIMESTAMP=null;r.setValueState(s.Error);i.error('Il valore inserito in "Ora Inizio" non può essere maggiore di quello inserito in "Ora Fine" ');return}else{o.getData()[I].ORAINIZIOTIMESTAMP=p;h=true}}else if(this.getTimeAsNumberOfMinutes(T)>=this.getTimeAsNumberOfMinutes("00:00")&&this.getTimeAsNumberOfMinutes(T)<=this.getTimeAsNumberOfMinutes("08:30")){p=new Date(R,D,f,T.split(":")[0],T.split(":")[1],"00");if(p>o.getData()[I].ORAFINETIMESTAMP){o.getData()[I].ORAINIZIO=null;o.getData()[I].ORAINIZIOTIMESTAMP=null;r.setValueState(s.Error);i.error('Il valore inserito in "Ora Inizio" non può essere maggiore di quello inserito in "Ora Fine" ');return}else{o.getData()[I].ORAINIZIOTIMESTAMP=p;h=true}}}}else{if(this.getTimeAsNumberOfMinutes(T)>=this.getTimeAsNumberOfMinutes("17:30")&&this.getTimeAsNumberOfMinutes(T)<=this.getTimeAsNumberOfMinutes("23:59")){p=new Date(E,N,u,T.split(":")[0],T.split(":")[1],"00");o.getData()[I].ORAINIZIOTIMESTAMP=p;r.setValueState(s.None)}else if(this.getTimeAsNumberOfMinutes(T)>=this.getTimeAsNumberOfMinutes("00:00")&&this.getTimeAsNumberOfMinutes(T)<=this.getTimeAsNumberOfMinutes("08:30")){p=new Date(R,D,f,T.split(":")[0],T.split(":")[1],"00");o.getData()[I].ORAINIZIOTIMESTAMP=p;r.setValueState(s.None)}}}else{if(A!==""&&A!==null){if(this.getTimeAsNumberOfMinutes(T)>=this.getTimeAsNumberOfMinutes("08:30")&&this.getTimeAsNumberOfMinutes(T)<=this.getTimeAsNumberOfMinutes("23:59")){p=new Date(E,N,u,T.split(":")[0],T.split(":")[1],"00");if(p>o.getData()[I].ORAFINETIMESTAMP){o.getData()[I].ORAINIZIO=null;o.getData()[I].ORAINIZIOTIMESTAMP=null;r.setValueState(s.Error);i.error('Il valore inserito in "Ora Inizio" non può essere maggiore di quello inserito in "Ora Fine" ');return}else{o.getData()[I].ORAINIZIOTIMESTAMP=p;h=true}}else if(this.getTimeAsNumberOfMinutes(T)>=this.getTimeAsNumberOfMinutes("00:00")&&this.getTimeAsNumberOfMinutes(T)<this.getTimeAsNumberOfMinutes("08:30")){p=new Date(R,D,f,T.split(":")[0],T.split(":")[1],"00");if(p>o.getData()[I].ORAFINETIMESTAMP){o.getData()[I].ORAINIZIO=null;o.getData()[I].ORAINIZIOTIMESTAMP=null;r.setValueState(s.Error);i.error('Il valore inserito in "Ora Inizio" non può essere maggiore di quello inserito in "Ora Fine" ');return}else{o.getData()[I].ORAINIZIOTIMESTAMP=p;h=true}}}else{if(this.getTimeAsNumberOfMinutes(T)>=this.getTimeAsNumberOfMinutes("08:30")&&this.getTimeAsNumberOfMinutes(T)<=this.getTimeAsNumberOfMinutes("23:59")){p=new Date(E,N,u,T.split(":")[0],T.split(":")[1],"00");o.getData()[I].ORAINIZIOTIMESTAMP=p;r.setValueState(s.None)}else if(this.getTimeAsNumberOfMinutes(T)>=this.getTimeAsNumberOfMinutes("00:00")&&this.getTimeAsNumberOfMinutes(T)<this.getTimeAsNumberOfMinutes("08:30")){p=new Date(R,D,f,T.split(":")[0],T.split(":")[1],"00");o.getData()[I].ORAINIZIOTIMESTAMP=p;r.setValueState(s.None)}}}}}}if(true){r.setValueState(s.None);var v=Math.abs(o.getData()[I].ORAFINETIMESTAMP-o.getData()[I].ORAINIZIOTIMESTAMP)/1e3;o.getData()[I].MINDIFFORAINIFINE=Math.floor(v/60);var m=o.getProperty("/");var V=0;var S=0;var c=0;var P=0;var b=0;var C=0;if(A!==""&&A!==undefined&&A!==null){var w=o.getData()[I].MINDIFFORAINIFINE/60;if(w){m[I].h1h=false;m[I].h12h=false;m[I].h24h=false;m[I].h46h=false;m[I].h68h=false;m[I].h8h=false;if(w>0&&w<=1){m[I].h1h=true;m[I].FASCIA=1}else if(w>1&&w<=2){m[I].h12h=true;m[I].FASCIA=2}else if(w>2&&w<=4){m[I].h24h=true;m[I].FASCIA=3}else if(w>4&&w<=6){m[I].h46h=true;m[I].FASCIA=4}else if(w>6&&w<=8){m[I].h68h=true;m[I].FASCIA=5}else if(w>8){m[I].h8h=true;m[I].FASCIA=6}}}for(var L=0;L<o.getData().length;L++){if(o.getData()[L].h1h==true){V=V+1}if(o.getData()[L].h12h==true){S=S+1}if(o.getData()[L].h24h==true){c=c+1}if(o.getData()[L].h46h==true){P=P+1}if(o.getData()[L].h68h==true){b=b+1}if(o.getData()[L].h8h==true){C=C+1}}this.getView().byId("txt1h").setText(V);this.getView().byId("txt12h").setText(S);this.getView().byId("txt24h").setText(c);this.getView().byId("txt46h").setText(P);this.getView().byId("txt68h").setText(b);this.getView().byId("txt8h").setText(C);o.setProperty("/",m);var F=this.getView().byId("idTableInterventi");var y=new sap.ui.model.json.JSONModel;var Y=this.sortInterventiDataForOraInzio(o);y.setData(Y);F.setModel(y,"RepintInterventiModel");this.filterRiposiSet(this.getView().byId("idTableInterventi"),l,o,I,false)}},tpChange2:function(e){var r=e.getSource(),a=e.getParameter("value"),n=e.getParameter("valid");var l=this.getView().byId("idTableReperibilita").getModel("RepintReperibilitaModel");var o=this.getView().byId("idTableInterventi").getModel("RepintInterventiModel");var I=e.getSource().getParent().getParent().indexOfItem(e.getSource().getParent());var T=o.getData()[I].ORAINIZIO;var A=a;var g=o.getData()[I].DATAINTERVENTO;var O;var N;var E;var u;var d;var R;var D;var f;var p;var h=false;o.getData()[I].FLAGCONT=false;o.getData()[I].RIPOSI=null;if(g===""||g===undefined||g===null){if(this.getView().byId("idTableReperibilita").getItems()[I]!==undefined){this.getView().byId("idTableReperibilita").getItems()[I].getCells()[2].setValueState(sap.ui.core.ValueState.Error)}i.error("Nella sezione Interventi valorizzata il campo data");return}for(var M=0;M<l.getData().length;++M){if(g===l.getData()[M].DATAREPERIBILITA||o.getData()[I].FLAGNOTTURNO){if(A===""||A===null){o.getData()[I].ORAFINE=null;o.getData()[I].ORAFINETIMESTAMP=null;r.setValueState(s.Error);i.error('Il campo "Ora Fine" non può essere lasciato vuoto');return}O=new Date(t.formatDateToMMDDYYYY(g));d=new Date(t.formatDateToMMDDYYYY(g));E=O.getFullYear();N=O.getMonth();u=O.getDate();d.setDate(O.getDate()+1);R=d.getFullYear();D=d.getMonth();f=d.getDate();if(o.getData()[I].FLAGNOTTURNO){if(this.getTimeAsNumberOfMinutes(A)<this.getTimeAsNumberOfMinutes("17:30")&&this.getTimeAsNumberOfMinutes(A)>this.getTimeAsNumberOfMinutes("08:30")){o.getData()[I].ORAFINE=null;o.getData()[I].ORAFINETIMESTAMP=null;r.setValueState(s.Error);i.error("Occorre inserire delle ore comprese nella fascia oraria 17:30 – 08:30");return}if(T!==""&&T!==null){if(this.getTimeAsNumberOfMinutes(A)>this.getTimeAsNumberOfMinutes("08:30")&&this.getTimeAsNumberOfMinutes(A)<this.getTimeAsNumberOfMinutes("17:30")){o.getData()[I].ORAFINE=null;o.getData()[I].ORAFINETIMESTAMP=null;r.setValueState(s.Error);i.error("Occorre inserire delle ore comprese nella fascia oraria 17:30 – 08:30")}else{if(this.getTimeAsNumberOfMinutes(A)>=this.getTimeAsNumberOfMinutes("17:30")&&this.getTimeAsNumberOfMinutes(A)<=this.getTimeAsNumberOfMinutes("23:59")){p=new Date(E,N,u,A.split(":")[0],A.split(":")[1],"00");if(p<o.getData()[I].ORAINIZIOTIMESTAMP){o.getData()[I].ORAFINE=null;o.getData()[I].ORAFINETIMESTAMP=null;r.setValueState(s.Error);i.error('Il valore inserito in "Ora Inizio" non può essere maggiore di quello inserito in "Ora Fine"');return}else{o.getData()[I].ORAFINETIMESTAMP=p;h=true}}else if(this.getTimeAsNumberOfMinutes(A)>=this.getTimeAsNumberOfMinutes("00:00")&&this.getTimeAsNumberOfMinutes(A)<=this.getTimeAsNumberOfMinutes("08:30")){p=new Date(R,D,f,A.split(":")[0],A.split(":")[1],"00");if(p<o.getData()[I].ORAINIZIOTIMESTAMP){o.getData()[I].ORAFINE=null;o.getData()[I].ORAFINETIMESTAMP=null;r.setValueState(s.Error);i.error('Il valore inserito in "Ora Inizio" non può essere maggiore di quello inserito in "Ora Fine"');return}else{o.getData()[I].ORAFINETIMESTAMP=p;h=true}}}}else{if(this.getTimeAsNumberOfMinutes(A)>=this.getTimeAsNumberOfMinutes("17:30")&&this.getTimeAsNumberOfMinutes(A)<=this.getTimeAsNumberOfMinutes("23:59")){p=new Date(E,N,u,A.split(":")[0],A.split(":")[1],"00");o.getData()[I].ORAFINETIMESTAMP=p;r.setValueState(s.None)}else if(this.getTimeAsNumberOfMinutes(A)>=this.getTimeAsNumberOfMinutes("00:00")&&this.getTimeAsNumberOfMinutes(A)<=this.getTimeAsNumberOfMinutes("08:30")){p=new Date(R,D,f,A.split(":")[0],A.split(":")[1],"00");o.getData()[I].ORAFINETIMESTAMP=p;r.setValueState(s.None)}}}else{if(l.getData()[M].Fer){if(this.getTimeAsNumberOfMinutes(A)<this.getTimeAsNumberOfMinutes("17:30")&&this.getTimeAsNumberOfMinutes(A)>this.getTimeAsNumberOfMinutes("08:30")){o.getData()[I].ORAFINE=null;o.getData()[I].ORAFINETIMESTAMP=null;r.setValueState(s.Error);i.error('Per i giorni lavorativi "Ora Inizio" deve essere compresa tra le 17:30 e le 08:30 del giorno successivo');return}if(T!==""&&T!==null){if(this.getTimeAsNumberOfMinutes(A)>this.getTimeAsNumberOfMinutes("08:30")&&this.getTimeAsNumberOfMinutes(A)<this.getTimeAsNumberOfMinutes("17:30")){o.getData()[I].ORAFINE=null;o.getData()[I].ORAFINETIMESTAMP=null;r.setValueState(s.Error);i.error('Per i giorni lavorativi "Ora Inizio" deve essere compresa tra le 17:30 e le 08:30 del giorno successivo')}else{if(this.getTimeAsNumberOfMinutes(A)>=this.getTimeAsNumberOfMinutes("17:30")&&this.getTimeAsNumberOfMinutes(A)<=this.getTimeAsNumberOfMinutes("23:59")){p=new Date(E,N,u,A.split(":")[0],A.split(":")[1],"00");if(p<o.getData()[I].ORAINIZIOTIMESTAMP){o.getData()[I].ORAFINE=null;o.getData()[I].ORAFINETIMESTAMP=null;r.setValueState(s.Error);i.error('Il valore inserito in "Ora Inizio" non può essere maggiore di quello inserito in "Ora Fine"');return}else{o.getData()[I].ORAFINETIMESTAMP=p;h=true}}else if(this.getTimeAsNumberOfMinutes(A)>=this.getTimeAsNumberOfMinutes("00:00")&&this.getTimeAsNumberOfMinutes(A)<=this.getTimeAsNumberOfMinutes("08:30")){p=new Date(R,D,f,A.split(":")[0],A.split(":")[1],"00");if(p<o.getData()[I].ORAINIZIOTIMESTAMP){o.getData()[I].ORAFINE=null;o.getData()[I].ORAFINETIMESTAMP=null;r.setValueState(s.Error);i.error('Il valore inserito in "Ora Inizio" non può essere maggiore di quello inserito in "Ora Fine"');return}else{o.getData()[I].ORAFINETIMESTAMP=p;h=true}}}}else{if(this.getTimeAsNumberOfMinutes(A)>=this.getTimeAsNumberOfMinutes("17:30")&&this.getTimeAsNumberOfMinutes(A)<=this.getTimeAsNumberOfMinutes("23:59")){p=new Date(E,N,u,A.split(":")[0],A.split(":")[1],"00");o.getData()[I].ORAFINETIMESTAMP=p;r.setValueState(s.None)}else if(this.getTimeAsNumberOfMinutes(A)>=this.getTimeAsNumberOfMinutes("00:00")&&this.getTimeAsNumberOfMinutes(A)<=this.getTimeAsNumberOfMinutes("08:30")){p=new Date(R,D,f,A.split(":")[0],A.split(":")[1],"00");o.getData()[I].ORAFINETIMESTAMP=p;r.setValueState(s.None)}}}else{if(T!==""&&T!==null){if(this.getTimeAsNumberOfMinutes(T)>=this.getTimeAsNumberOfMinutes("00:00")&&this.getTimeAsNumberOfMinutes(T)<this.getTimeAsNumberOfMinutes("08:30")){if(this.getTimeAsNumberOfMinutes(A)>this.getTimeAsNumberOfMinutes("08:30")){o.getData()[I].ORAFINE=null;o.getData()[I].ORAFINETIMESTAMP=null;r.setValueState(s.Error);i.error("Dalle 08.30 del "+t.formatDateInterventi(O)+" fino alle 8.30 del "+t.formatDateInterventi(d));return}}if(this.getTimeAsNumberOfMinutes(A)>this.getTimeAsNumberOfMinutes("08:30")&&this.getTimeAsNumberOfMinutes(A)<=this.getTimeAsNumberOfMinutes("23:59")){p=new Date(E,N,u,A.split(":")[0],A.split(":")[1],"00");if(p<o.getData()[I].ORAINIZIOTIMESTAMP){o.getData()[I].ORAFINE=null;o.getData()[I].ORAFINETIMESTAMP=null;r.setValueState(s.Error);i.error('Il valore inserito in "Ora Inizio" non può essere maggiore di quello inserito in "Ora Fine"');return}else{o.getData()[I].ORAFINETIMESTAMP=p;h=true}}else if(this.getTimeAsNumberOfMinutes(A)>=this.getTimeAsNumberOfMinutes("00:00")&&this.getTimeAsNumberOfMinutes(A)<=this.getTimeAsNumberOfMinutes("08:30")){p=new Date(R,D,f,A.split(":")[0],A.split(":")[1],"00");if(p<o.getData()[I].ORAINIZIOTIMESTAMP){o.getData()[I].ORAFINE=null;o.getData()[I].ORAFINETIMESTAMP=null;r.setValueState(s.Error);i.error('Il valore inserito in "Ora Inizio" non può essere maggiore di quello inserito in "Ora Fine"');return}else{o.getData()[I].ORAFINETIMESTAMP=p;h=true}}}else{if(this.getTimeAsNumberOfMinutes(A)>this.getTimeAsNumberOfMinutes("08:30")&&this.getTimeAsNumberOfMinutes(A)<=this.getTimeAsNumberOfMinutes("23:59")){p=new Date(E,N,u,A.split(":")[0],A.split(":")[1],"00");o.getData()[I].ORAFINETIMESTAMP=p;r.setValueState(s.None)}else if(this.getTimeAsNumberOfMinutes(A)>=this.getTimeAsNumberOfMinutes("00:00")&&this.getTimeAsNumberOfMinutes(A)<=this.getTimeAsNumberOfMinutes("08:30")){p=new Date(R,D,f,A.split(":")[0],A.split(":")[1],"00");o.getData()[I].ORAFINETIMESTAMP=p;r.setValueState(s.None)}}}}}}if(h){r.setValueState(s.None);var v=Math.abs(o.getData()[I].ORAFINETIMESTAMP-o.getData()[I].ORAINIZIOTIMESTAMP)/1e3;o.getData()[I].MINDIFFORAINIFINE=Math.floor(v/60);var m=o.getProperty("/");var V=0;var S=0;var c=0;var P=0;var b=0;var C=0;if(T!==""&&T!==undefined&&T!==null){var w=o.getData()[I].MINDIFFORAINIFINE/60;if(w){m[I].h1h=false;m[I].h12h=false;m[I].h24h=false;m[I].h46h=false;m[I].h68h=false;m[I].h8h=false;if(w>0&&w<=1){m[I].h1h=true;m[I].FASCIA=1}else if(w>1&&w<=2){m[I].h12h=true;m[I].FASCIA=2}else if(w>2&&w<=4){m[I].h24h=true;m[I].FASCIA=3}else if(w>4&&w<=6){m[I].h46h=true;m[I].FASCIA=4}else if(w>6&&w<=8){m[I].h68h=true;m[I].FASCIA=5}else if(w>8){m[I].h8h=true;m[I].FASCIA=6}}}for(var L=0;L<o.getData().length;L++){if(o.getData()[L].h1h==true){V=V+1}if(o.getData()[L].h12h==true){S=S+1}if(o.getData()[L].h24h==true){c=c+1}if(o.getData()[L].h46h==true){P=P+1}if(o.getData()[L].h68h==true){b=b+1}if(o.getData()[L].h8h==true){C=C+1}}this.getView().byId("txt1h").setText(V);this.getView().byId("txt12h").setText(S);this.getView().byId("txt24h").setText(c);this.getView().byId("txt46h").setText(P);this.getView().byId("txt68h").setText(b);this.getView().byId("txt8h").setText(C);o.setProperty("/",m);this.filterRiposiSet(this.getView().byId("idTableInterventi"),l,o,I,false)}},getTimeAsNumberOfMinutes:function(e){var t=e.split(":");var i=parseInt(t[0])*60+parseInt(t[1]);return parseInt(i)},onChiamatodaChange:function(e){var t=this.getView().byId("idTableInterventi").getModel("RepintInterventiModel").getProperty("/");var i=e.getSource().getParent().getParent().indexOfItem(e.getSource().getParent());var r=this.getView().byId("idTableReperibilita").getModel("RepintReperibilitaModel");var a=this.getView().byId("idTableInterventi").getModel("RepintInterventiModel");var n=this.getView().byId("idTableInterventi");t[i].CHIAMATODA=e.getParameter("selectedItem").getText();if(e.getParameter("selectedItem").getText()=="Others"){t[i].FLAGNOTTURNO=false}else{n.getItems()[i].getCells()[6].setValue("");if(e.getParameter("selectedItem").getText()=="LPN"){t[i].FLAGNOTTURNO=true}else{t[i].FLAGNOTTURNO=false}a.setProperty("/",t);a.updateBindings(true)}if(this.handleInterDateLPNChange(e)){this.filterRiposiSet(this.getView().byId("idTableInterventi"),r,a,i,true)}},onEnterChaimatodaFreeTxt:function(e){var t=e.getSource().getParent().getParent().indexOfItem(e.getSource().getParent());var i=this.getView().byId("idTableInterventi");if(i.getItems()[t].getCells()[5].getSelectedItem().getText()!=="Others"){i.getItems()[t].getCells()[6].setValue(null)}},onEnterCausa:function(e){var t=e.getSource().getParent().getParent().indexOfItem(e.getSource().getParent());var i=this.getView().byId("idTableReperibilita").getModel("RepintReperibilitaModel");var r=this.getView().byId("idTableInterventi").getModel("RepintInterventiModel");var a=r.getProperty("/");if(a.length>0){this.filterRiposiSet(this.getView().byId("idTableInterventi"),i,r,t,false)}},validateData:function(e,t,r){var a=this;var n=true;if(a.getOwnerComponent().getModel("viewProperties").getProperty("/ANNOMESE")===""||a.getOwnerComponent().getModel("viewProperties").getProperty("/ANNOMESE")===null||a.getOwnerComponent().getModel("viewProperties").getProperty("/ANNOMESE")===undefined){a.getOwnerComponent().getModel("viewProperties").setProperty("/validData",false);i.error("Il campo Mese/Anno deve essere valorizzato");n=false;return}if(t===null||t===undefined||t===""||(r===null||r===undefined||r==="")){a.getOwnerComponent().getModel("viewProperties").setProperty("/validData",false);n=false;return}if((a.getOwnerComponent().getModel("viewProperties").getProperty("/MATRICOLA_DEPUTY")===undefined||a.getOwnerComponent().getModel("viewProperties").getProperty("/MATRICOLA_DEPUTY")==="")&&(e[0].MATRICOLA_RESP===""||e[0].MATRICOLA_RESP==undefined)){a.getOwnerComponent().getModel("viewProperties").setProperty("/validData",false);i.error("Resp. Servizio and Deputy Manager value both cannot be null");n=false;return}if(t.length===1&&(t[0].DATAREPERIBILITA===""||t[0].DATAREPERIBILITA===null||t[0].DATAREPERIBILITA===undefined)){a.getOwnerComponent().getModel("viewProperties").setProperty("/validData",true);a.getOwnerComponent().getModel("viewProperties").setProperty("/ReperibilitaStatus",false)}else{a.getOwnerComponent().getModel("viewProperties").setProperty("/ReperibilitaStatus",true);var l=this.getView().byId("idTableReperibilita");for(var o=0;o<t.length;++o){if(t[o].DATAREPERIBILITA===""||t[o].DATAREPERIBILITA===null||t[o].DATAREPERIBILITA===undefined){l.getItems()[o].getCells()[0].setValueState(sap.ui.core.ValueState.Error);a.getOwnerComponent().getModel("viewProperties").setProperty("/validData",false);i.error('La data della "Reperibilità" deve essere valorizzata');n=false;return}else{l.getItems()[o].getCells()[0].setValueState(sap.ui.core.ValueState.None)}}}var s=new sap.ui.model.json.JSONModel;var I=this.getView().byId("idTableInterventi").getModel("RepintInterventiModel");var T=this.getView().byId("idTableInterventi");var A=a.sortInterventiDateData(I);s.setData(A);T.setModel(s,"RepintInterventiModel");if(A.length===1&&(A[0].DATAINTERVENTO===""||A[0].DATAINTERVENTO===null||A[0].DATAINTERVENTO===undefined)&&(A[0].ORAINIZIO===""||A[0].ORAINIZIO===null||A[0].ORAINIZIO===undefined)&&(A[0].ORAFINE===""||A[0].ORAFINE===null||A[0].ORAFINE===undefined)&&(A[0].CHIAMATODA===""||A[0].CHIAMATODA===null||A[0].CHIAMATODA===undefined)&&(A[0].CAUSA===""||A[0].CAUSA===null||A[0].CAUSA===undefined)){a.getOwnerComponent().getModel("viewProperties").setProperty("/validData",true);a.getOwnerComponent().getModel("viewProperties").setProperty("/InterventiStatus",false)}else if(A.length===1&&(A[0].DATAINTERVENTO!==""&&A[0].DATAINTERVENTO!==null&&A[0].DATAINTERVENTO!==undefined)&&(A[0].ORAINIZIO!==""&&A[0].ORAINIZIO!==null&&A[0].ORAINIZIO!==undefined)&&(A[0].ORAFINE!==""&&A[0].ORAFINE!==null&&A[0].ORAFINE!==undefined)){if(A[0].CHIAMATODA==="Others"&&(A[0].CHIAMATODA_ALTRO===""||A[0].CHIAMATODA_ALTRO===undefined||A[0].CHIAMATODA_ALTRO===undefined)){a.getOwnerComponent().getModel("viewProperties").setProperty("/validData",false);a.getOwnerComponent().getModel("viewProperties").setProperty("/InterventiStatus",false);i.error('Il campo "Altro" deve essere valorizzato quando si selzione in "Chiamato da" il valore "Altro"');n=false;return}else{a.getOwnerComponent().getModel("viewProperties").setProperty("/validData",true);a.getOwnerComponent().getModel("viewProperties").setProperty("/InterventiStatus",true)}}if(a.getOwnerComponent().getModel("viewProperties").getProperty("/ReperibilitaStatus")&&A.length===1&&(A[0].DATAINTERVENTO===""||A[0].DATAINTERVENTO===null||A[0].DATAINTERVENTO===undefined)&&(A[0].ORAINIZIO===""||A[0].ORAINIZIO===null||A[0].ORAINIZIO===undefined)&&(A[0].ORAFINE===""||A[0].ORAFINE===null||A[0].ORAFINE===undefined)&&(A[0].CHIAMATODA===""||A[0].CHIAMATODA===null||A[0].CHIAMATODA===undefined)&&(A[0].CAUSA===""||A[0].CAUSA===null||A[0].CAUSA===undefined)){a.getOwnerComponent().getModel("viewProperties").setProperty("/validData",true);a.getOwnerComponent().getModel("viewProperties").setProperty("/InterventiStatus",false)}else{if(a.getOwnerComponent().getModel("viewProperties").getProperty("/ReperibilitaStatus")&&A.length===1&&(A[0].DATAINTERVENTO===""||A[0].DATAINTERVENTO===null||A[0].DATAINTERVENTO===undefined)){a.getOwnerComponent().getModel("viewProperties").setProperty("/validData",false);i.error("Nella sezione Interventi valorizzata il campo data");n=false;return}else if(a.getOwnerComponent().getModel("viewProperties").getProperty("/ReperibilitaStatus")&&A.length===1&&(A[0].ORAINIZIO===""||A[0].ORAINIZIO===null||A[0].ORAINIZIO===undefined)){a.getOwnerComponent().getModel("viewProperties").setProperty("/validData",false);i.error("Il campo Ora Inizio deve essere valorizzato");n=false;return}else if(a.getOwnerComponent().getModel("viewProperties").getProperty("/ReperibilitaStatus")&&A.length===1&&(A[0].ORAFINE===""||A[0].ORAFINE===null||A[0].ORAFINE===undefined)){a.getOwnerComponent().getModel("viewProperties").setProperty("/validData",false);i.error('Il campo "Ora Fine" non può essere lasciato vuoto');n=false;return}else if(a.getOwnerComponent().getModel("viewProperties").getProperty("/ReperibilitaStatus")&&A.length===1&&(A[0].CHIAMATODA===""||A[0].CHIAMATODA===null||A[0].CHIAMATODA===undefined)){a.getOwnerComponent().getModel("viewProperties").setProperty("/validData",false);i.error('Il campo "Chiamato da" deve essere valorizzato');n=false;return}else if(a.getOwnerComponent().getModel("viewProperties").getProperty("/ReperibilitaStatus")&&A.length===1&&A[0].CHIAMATODA==="Others"){if(A[0].CHIAMATODA_ALTRO===""||A[0].CHIAMATODA_ALTRO===undefined||A[0].CHIAMATODA_ALTRO===undefined){a.getOwnerComponent().getModel("viewProperties").setProperty("/validData",false);i.error('Il campo "Altro" deve essere valorizzato quando si selzione in "Chiamato da" il valore "Altro"');n=false;return}}else if(a.getOwnerComponent().getModel("viewProperties").getProperty("/ReperibilitaStatus")&&A.length===1&&(A[0].CAUSA===""||A[0].CAUSA===null||A[0].CAUSA===undefined)){a.getOwnerComponent().getModel("viewProperties").setProperty("/validData",false);i.error('Il campo "Causa" deve essere valorizzato');n=false;return}}if(A.length>1){a.getOwnerComponent().getModel("viewProperties").setProperty("/InterventiStatus",true);for(var g=0;g<A.length;++g){if(A[g].DATAINTERVENTO===null||A[g].DATAINTERVENTO===""||A[g].DATAINTERVENTO===undefined){T.getItems()[g].getCells()[2].setValueState(sap.ui.core.ValueState.Error);a.getOwnerComponent().getModel("viewProperties").setProperty("/validData",false);i.error("Nella sezione Interventi valorizzata il campo data");n=false;return}else{T.getItems()[g].getCells()[2].setValueState(sap.ui.core.ValueState.None)}if(A[g].ORAINIZIO===null||A[g].ORAINIZIO===""||A[g].ORAINIZIO===undefined){T.getItems()[g].getCells()[3].setValueState(sap.ui.core.ValueState.Error);a.getOwnerComponent().getModel("viewProperties").setProperty("/validData",false);i.error("Il campo Ora Inizio deve essere valorizzato");n=false;return}else{T.getItems()[g].getCells()[3].setValueState(sap.ui.core.ValueState.None)}if(A[g].ORAFINE===null||A[g].ORAFINE===""||A[g].ORAFINE===undefined){T.getItems()[g].getCells()[4].setValueState(sap.ui.core.ValueState.Error);a.getOwnerComponent().getModel("viewProperties").setProperty("/validData",false);i.error('Il campo "Ora Fine" non può essere lasciato vuoto');n=false;return}else{T.getItems()[g].getCells()[4].setValueState(sap.ui.core.ValueState.None)}if(A[g].CHIAMATODA===null||A[g].CHIAMATODA===""||A[g].CHIAMATODA===undefined){T.getItems()[g].getCells()[5].setValueState(sap.ui.core.ValueState.Error);a.getOwnerComponent().getModel("viewProperties").setProperty("/validData",false);i.error('Il campo "Chiamato da" deve essere valorizzato');n=false;return}else{T.getItems()[g].getCells()[5].setValueState(sap.ui.core.ValueState.None)}if(A[g].CHIAMATODA==="Others"){if(A[g].CHIAMATODA_ALTRO===""||A[g].CHIAMATODA_ALTRO===undefined||A[g].CHIAMATODA_ALTRO===undefined){T.getItems()[g].getCells()[6].setValueState(sap.ui.core.ValueState.Error);a.getOwnerComponent().getModel("viewProperties").setProperty("/validData",false);i.error('Il campo "Altro" deve essere valorizzato quando si selzione in "Chiamato da" il valore "Altro"');n=false;return}}else{T.getItems()[g].getCells()[6].setValueState(sap.ui.core.ValueState.None)}if(A[g].CAUSA===null||A[g].CAUSA===""||A[g].CAUSA===undefined){T.getItems()[g].getCells()[8].setValueState(sap.ui.core.ValueState.Error);a.getOwnerComponent().getModel("viewProperties").setProperty("/validData",false);i.error('Il campo "Causa" deve essere valorizzato');n=false;return}else{T.getItems()[g].getCells()[8].setValueState(sap.ui.core.ValueState.None)}if(A[g].ORAINIZIOTIMESTAMP===""||A[g].ORAINIZIOTIMESTAMP===undefined||A[g].ORAINIZIOTIMESTAMP===null){T.getItems()[g].getCells()[3].setValueState(sap.ui.core.ValueState.Error);T.getItems()[g].getCells()[4].setValueState(sap.ui.core.ValueState.Error);i.error("For Interventi Date "+A[g].DATAINTERVENTO+" Ora Inizio and Ora Fine value cannot be blank");a.getOwnerComponent().getModel("viewProperties").setProperty("/validData",false);n=false;return}else{T.getItems()[g].getCells()[3].setValueState(sap.ui.core.ValueState.None);T.getItems()[g].getCells()[4].setValueState(sap.ui.core.ValueState.None)}if(A[g].ORAFINETIMESTAMP===""||A[g].ORAFINETIMESTAMP===undefined||A[g].ORAFINETIMESTAMP===null){T.getItems()[g].getCells()[3].setValueState(sap.ui.core.ValueState.Error);T.getItems()[g].getCells()[4].setValueState(sap.ui.core.ValueState.Error);a.getOwnerComponent().getModel("viewProperties").setProperty("/validData",false);i.error("For Interventi Date "+A.getData()[g].DATAINTERVENTO+" Ora Inizio and Ora Fine value cannot be blank");n=false;return}else{T.getItems()[g].getCells()[3].setValueState(sap.ui.core.ValueState.None);T.getItems()[g].getCells()[4].setValueState(sap.ui.core.ValueState.None)}}}a.getOwnerComponent().getModel("viewProperties").setProperty("/validData",n)},handleCreateAfterSubmit:function(e){var r=this;r.getLPNReperSet();var a=r.getView().byId("idTableReperibilita").getModel("RepintReperibilitaModel").getProperty("/");var n=r.getView().byId("idTableInterventi").getModel("RepintInterventiModel").getProperty("/");var l=r.getView().byId("idTableInterventi").getModel("RepintInterventiModel");var o=[];var s=r.getView().getModel("RepintEmpdataModel").getData();var I=$.unique(e.map(function(e){return e.DATAINTERVENTO}));var T=[];var A={};var g=[];var O={};if(r.getOwnerComponent().getModel("viewProperties").getProperty("/ReperibilitaStatus")){for(var N=0;N<a.length;++N){if(a[N].Dom===true){a[N].TIPOGIORNO="F"}else if(a[N].Sab===true){a[N].TIPOGIORNO="S"}else{a[N].TIPOGIORNO="L"}o=[];o=a[N].DATAREPERIBILITA.split("-");A={IDSCHEDA:a[N].IDSCHEDA,IDREPERIBILITA:a[N].IDREPERIBILITA,DATAREPERIBILITA:o[2]+"-"+o[1]+"-"+o[0]+"T00:00:00",TIPOGIORNO:a[N].TIPOGIORNO};T.push(A);A={}}}else{T=[]}if(r.getOwnerComponent().getModel("viewProperties").getProperty("/InterventiStatus")){o=[];var E;var u;for(var d=0;d<n.length;++d){o=[];o=n[d].DATAINTERVENTO.split("-");E=n[d].ORAINIZIOTIMESTAMP.toUTCString();u=n[d].ORAFINETIMESTAMP.toUTCString();O={IDINTERVENTO:n[d].IDINTERVENTO,DATAINTERVENTO:o[2]+"-"+o[1]+"-"+o[0]+"T00:00:00",ORAINIZIO:n[d].ORAINIZIO,ORAFINE:n[d].ORAFINE,CHIAMATODA:n[d].CHIAMATODA===undefined?"":n[d].CHIAMATODA,CAUSA:n[d].CAUSA===null||n[d].CAUSA===undefined?"":n[d].CAUSA,FASCIA:parseInt(n[d].FASCIA),IDSCHEDA:n[d].IDSCHEDA,STESSACAUSALE:n[d].STESSACAUSALE,CONTINTERVENTO:n[d].CONTINTERVENTO===""||n[d].CONTINTERVENTO===null?0:n[d].CONTINTERVENTO,FLAGNOTTURNO:n[d].FLAGNOTTURNO?1:0,FLAGCONT:n[d].FLAGCONT?1:0,ORAFINETIMESTAMP:t.formatUTCDate(u),ORAINIZIOTIMESTAMP:t.formatUTCDate(E),WORKINGDAY:n[d].WORKINGDAY?1:0,NONWORKINGDAY:n[d].NONWORKINGDAY?1:0,CHECKOK:n[d].CHECKOK,RIPOSI:n[d].RIPOSI,CHIAMATODA_ALTRO:n[d].CHIAMATODA_ALTRO===undefined||n[d].CHIAMATODA_ALTRO===null||n[d].CHIAMATODA_ALTRO===""?"":n[d].CHIAMATODA_ALTRO,RIPOSI_HH:n[d].RIPOSI===""?0:parseInt(n[d].RIPOSI.substr(0,n[d].RIPOSI.indexOf("H"))),DURATA:parseInt(n[d].MINDIFFORAINIFINE),MINDIFFORAINIFINE:parseInt(n[d].MINDIFFORAINIFINE),TOTALE_GIORNI_RIPOSI_COMPENSATIVI:n[d].TOTALE_GIORNI_RIPOSI_COMPENSATIVI,INTERVENTI_DETTAGLIO:n[d].INTERVENTI_DETTAGLIO};g.push(O);O={}}}else{g=[]}var R={};o=[];if((r.getOwnerComponent().getModel("viewProperties").getProperty("/MATRICOLA_DEPUTY")===undefined||r.getOwnerComponent().getModel("viewProperties").getProperty("/MATRICOLA_DEPUTY")==="")&&s[0].MATRICOLA_RESP!==""){s[0].MATRICOLA_DEPUTY=""}else{s[0].MATRICOLA_DEPUTY=r.getOwnerComponent().getModel("viewProperties").getProperty("/MATRICOLA_DEPUTY")}var D=(new Date).toUTCString();var f;if(r.invioBozzaFlag&&!r.invioFlag){f=0}else if(r.invioFlag&&!r.invioBozzaFlag){f=100}R={IDSCHEDA:r.getOwnerComponent().getModel("viewProperties").getProperty("/IDSCHEDA"),ANNOMESE:r.getOwnerComponent().getModel("viewProperties").getProperty("/ANNOMESE").split("-")[0]+"-"+r.getOwnerComponent().getModel("viewProperties").getProperty("/ANNOMESE").split("-")[1]+"-01",STATO:f,DATACREAZIONE:t.formatUTCDate(D),ID:s[0].ID,MATRICOLA:s[0].MATRICOLA,COGNOME:s[0].COGNOME,NOME:s[0].NOME,CDC:s[0].CDC,EMAIL:s[0].EMAIL,STABILIMENTO_ATTUALE:s[0].STABILIMENTO_ATTUALE,LIVELLO:s[0].LIVELLO,MATRICOLA_RESP:s[0].MATRICOLA_RESP,MATRICOLA_DEPUTY:s[0].MATRICOLA_DEPUTY,UNITAORGANIZZATIVA:s[0].UNITAORGANIZZATIVA,DEPARTMENT:s[0].DEPARTMENT,ManagerFirstName:s[0].ManagerFirstName,ManagerLastName:s[0].ManagerLastName,Child1:T,Child2:g};var p={Object:{Header:R}};console.log("********** handleCreateAfterSubmit *********");console.log("PAYLOAD AFTER SUBMIT");console.log(p);this.sServiceUrl=this.getOwnerComponent().getModel().sServiceUrl;$.ajax({url:this.sServiceUrl+"/",type:"GET",beforeSend:function(e){e.setRequestHeader("X-CSRF-Token","Fetch")},success:function(e,t,r){var a=r.getResponseHeader("X-CSRF-Token");$.ajax({url:"/HANAMDC/REPINT/RepintEmployee/xsjs/DeepInsert.xsjs",type:"POST",contentType:"application/json",data:JSON.stringify(p),beforeSend:function(e){e.setRequestHeader("X-CSRF-Token",a)},success:function(e,t,i){console.log("*********** SUCCESS HANDLE CREATE AFTER SUBMIT ******************");console.log(e);console.log(t)},error:function(e,t,r){console.log("Error in DeepInsert");i.error("Errore nell'invio della scheda. Contatta l'amministratore");jQuery.sap.log.getLogger().error("Error while perfoming Invio operation in handleCreateAfterSubmit(). Please contact administrator."+t.toString());console.log(t)}})}})},getLPNReperSet:function(){var e=this;var r=e.getOwnerComponent().getModel("basexsoModel");var a=e.getView().byId("idTableInterventi").getModel("RepintInterventiModel");var n=0;var l=0;var o=0;var s=false;var I=false;e.INTERFlag=false;r.attachRequestSent(function(){e._busyDialog.open()});r.attachRequestCompleted(function(){if(s&&I&&e.INTERFlag){var t={IDSCHEDA:T,TOTALE_GIORNI_RIPOSI_COMPENSATIVI:e.getOwnerComponent().getModel("viewProperties").getProperty("/TOTALE_GIORNI_RIPOSI_COMPENSATIVI"),TOTALE_LPN:o,TOTALE_IMPORTI_REPERIBILITA:n,TOTALE_IMPORTI_INTERVENTO:e.getOwnerComponent().getModel("viewProperties").getProperty("/TOTALE_IMPORTI_INTERVENTO"),TOTALE_GIORNI_REPERIBILITA:l};var r={Object:{Header:t}};console.log("TOTALE REPORT - Payload");console.log(r);var a=e.getOwnerComponent().getModel().sServiceUrl;$.ajax({url:a+"/",type:"GET",beforeSend:function(e){e.setRequestHeader("X-CSRF-Token","Fetch")},success:function(t,a,n){var l=n.getResponseHeader("X-CSRF-Token");$.ajax({url:"/HANAMDC/REPINT/RepintEmployee/xsjs/insertSchedeRieplogo.xsjs",type:"POST",contentType:"application/json",data:JSON.stringify(r),beforeSend:function(e){e.setRequestHeader("X-CSRF-Token",l)},success:function(t,i,r){console.log("*********** getLPNReperSet SUCCESS ******************");s=false;I=false;e.INTERFlag=false},error:function(e,t,r){console.log("Error in getLPNReperSet");i.error("Errore nell'invio della scheda. Contatta l'amministratore");jQuery.sap.log.getLogger().error("Error while perfoming Invio operation in getLPNReperSet() function. Please contact administrator."+t.toString())}})}})}e._busyDialog.close()});var T=e.getOwnerComponent().getModel("viewProperties").getProperty("/IDSCHEDA");var A=[];var g=new sap.ui.model.Filter("IDSCHEDA",sap.ui.model.FilterOperator.EQ,T);A.push(g);var O=new sap.ui.model.json.JSONModel;var N=[];var E={};var u=0;r.read("/LPNSET",{filters:A,success:function(i,r){for(var a=0;a<i.results.length;++a){E={IDSCHEDA:i.results[a].IDSCHEDA,LIVELLO:i.results[a].LIVELLO,DATAINTERVENTO:t.formatDate(i.results[a].DATAINTERVENTO),CC_DIFFERENCE:i.results[a].CC_DIFFERENCE,VALORE:i.results[a].VALORE};o=o+parseInt(i.results[a].VALORE);N.push(E);E={}}console.log("LPNSET");console.log(N);O.setData(N);e.getView().setModel(O,"LPNSetModel");s=true}.bind(e),error:function(e){i.error("Data fetch failed for LPNSET. Please contact administrator.");jQuery.sap.log.getLogger().error("Data fetch failed for LPNSET. Please contact administrator."+e.toString())}.bind(e)});var d=new sap.ui.model.json.JSONModel;var R=[];var D={};r.read("/REPERSET",{filters:A,success:function(i,r){l=i.results.length;for(var a=0;a<i.results.length;++a){D={IDSCHEDA:i.results[a].IDSCHEDA,LIVELLO:i.results[a].LIVELLO,DATAREPERIBILITA:t.formatDate(i.results[a].DATAREPERIBILITA),GIORNI:i.results[a].GIORNI,IMPORTO:i.results[a].IMPORTO};n=n+parseInt(i.results[a].IMPORTO);R.push(D);D={}}console.log("REPERSET");console.log(R);d.setData(R);e.getView().setModel(d,"ReperSetModel");I=true}.bind(e),error:function(e){i.error("Data fetch failed for REPERSET. Please contact administrator.");jQuery.sap.log.getLogger().error("Data fetch failed for REPERSET. Please contact administrator."+e.toString())}.bind(e)});var f=[];var p=new sap.ui.model.Filter("IDSCHEDA",sap.ui.model.FilterOperator.EQ,T);f.push(p);var h=new sap.ui.model.json.JSONModel;var M=[];var v={};r.read("/INTERVENTIEMP",{filters:f,success:function(i,r){for(var n=0;n<i.results.length;++n){v={IDSCHEDA:i.results[n].IDSCHEDA,LIVELLO:i.results[n].LIVELLO,DATAINTERVENTO:t.formatInterventiDate(i.results[n].DATAINTERVENTO),INTERVENTO_DATE:i.results[n].INTERVENTO_DATE,INTERVENTO_DAY:i.results[n].INTERVENTO_DAY,INTERVENTO_DAYNAME:i.results[n].INTERVENTO_DAYNAME,FLAGNOTTURNO:i.results[n].FLAGNOTTURNO,ORAINIZIO:i.results[n].ORAINIZIO,ORAFINE:i.results[n].ORAFINE,WORKINGDAY:i.results[n].WORKINGDAY,NONWORKINGDAY:i.results[n].NONWORKINGDAY,TimeSlot:"",amount:""};M.push(v);v={}}console.log("Interventoset");console.log(N);h.setData(M);e.getView().setModel(h,"InterventoSetModel");e.getIMPORTIINTERVENTI2018(h,a,e.INTERFlag);console.log("AFTER getIMPORTIINTERVENTI2018")}.bind(e),error:function(e){i.error("Data fetch failed for INTERVENTIEMP. Please contact administrator.");jQuery.sap.log.getLogger().error("Data fetch failed for INTERVENTIEMP. Please contact administrator."+e.toString())}.bind(e)});console.log("IN THE END")},getIMPORTIINTERVENTI2018:function(e,t,r){var a=this;var n=new sap.ui.model.json.JSONModel;var l=[];var o={};var s;if(a.getView().getModel("RepintEmpdataModel")!==undefined){s=a.getView().getModel("RepintEmpdataModel").getProperty("/0/LIVELLO").toString()}var I=[];var T=new sap.ui.model.Filter("LIVELLO",sap.ui.model.FilterOperator.EQ,s);I.push(T);var A=a.getOwnerComponent().getModel("basexsoModel");A.read("/IMPORTIINTERVENTI2018",{filters:I,success:function(i,s){for(var I=0;I<i.results.length;++I){o={IDIMPORTIINTERVENTO:i.results[I].IDIMPORTIINTERVENTO,IDTIPOGIORNO:i.results[I].IDTIPOGIORNO,ORA_INI:i.results[I].ORA_INI,MIN_INI:i.results[I].MIN_INI,ORA_FINE:i.results[I].ORA_FINE,MIN_FINE:i.results[I].MIN_FINE,VALORE:i.results[I].VALORE,LIVELLO:i.results[I].LIVELLO,ORAINIZIO:i.results[I].ORAINIZIO,ORAFINE:i.results[I].ORAFINE,ORA_INI_NORM_830:i.results[I].ORA_INI_NORM_830,ORA_FINE_NORM_830:i.results[I].ORA_FINE_NORM_830};l.push(o);o={}}n.setData(l);a.getView().setModel(n,"IINTERVENTI2018SetModel");a.calculateIntervento(e,n,t,r)}.bind(a),error:function(e){i.error("Data fetch failed for IMPORTIINTERVENTI2018. Please contact administrator.");jQuery.sap.log.getLogger().error("IMPORTIINTERVENTI2018 data fetch failed"+e.toString())}.bind(a)})},calculateIntervento:function(e,t,i,r){var a=this;var n;var l;var o=[];var s=[];var I=[];var T=[];var A=false;var g=false;var O=false;if(a.getView().getModel("InterventoSetModel")!==undefined){if(a.getView().getModel("InterventoSetModel").getData().length>0){n=a.sortInterventiDateData(e);o=this.convDeepStarct(n)}}if(a.getView().getModel("IINTERVENTI2018SetModel")!==undefined){if(a.getView().getModel("IINTERVENTI2018SetModel").getData().length>0){l=a.getView().getModel("IINTERVENTI2018SetModel").getData()}}var N;if(a.getView().getModel("RepintEmpdataModel")!==undefined){N=a.getView().getModel("RepintEmpdataModel").getProperty("/0/LIVELLO").toString()}if(o&&l){for(var E=0;E<o.length;E++){s=[];if(o[E].WORKINGDAY===1){for(var u=0;u<o[E].childnode.length;u++){if(o[E].childnode[u].ORAINIZIO>111220201730&&o[E].childnode[u].ORAINIZIO<=111220202300&&o[E].childnode[u].ORAFINE>111220201730&&o[E].childnode[u].ORAFINE<=111220202300){var d=l.filter(function(e){return e.ORAINIZIO==="17:30"&&e.ORAFINE==="23:00"&&e.LIVELLO===N&&e.IDTIPOGIORNO===1});if(d.length>0){var R={IDSCHEDA:o[E].childnode[u].IDSCHEDA,LIVELLO:o[E].childnode[u].LIVELLO,DATAINTERVENTO:o[E].childnode[u].DATAINTERVENTO,INTERVENTO_DATE:o[E].childnode[u].INTERVENTO_DATE,INTERVENTO_DAY:o[E].childnode[u].INTERVENTO_DAY,INTERVENTO_DAYNAME:o[E].childnode[u].INTERVENTO_DAYNAME,FLAGNOTTURNO:o[E].childnode[u].FLAGNOTTURNO,ORAINIZIO:o[E].childnode[u].ORAINIZIO,ORAFINE:o[E].childnode[u].ORAFINE,WORKINGDAY:o[E].childnode[u].WORKINGDAY,NONWORKINGDAY:o[E].childnode[u].NONWORKINGDAY,TimeSlot:"ST2",amount:d[0].VALORE};s.push(R);I.push(R);R={}}}else if(o[E].childnode[u].ORAINIZIO>111220202300&&o[E].childnode[u].ORAINIZIO<=121220200830&&o[E].childnode[u].ORAFINE>111220202300&&o[E].childnode[u].ORAFINE<=121220200830){var D=l.filter(function(e){return e.ORAINIZIO==="23:00"&&e.ORAFINE==="08:30"&&e.LIVELLO===N&&e.IDTIPOGIORNO===1});if(D.length>0){var R={IDSCHEDA:o[E].childnode[u].IDSCHEDA,LIVELLO:o[E].childnode[u].LIVELLO,DATAINTERVENTO:o[E].childnode[u].DATAINTERVENTO,INTERVENTO_DATE:o[E].childnode[u].INTERVENTO_DATE,INTERVENTO_DAY:o[E].childnode[u].INTERVENTO_DAY,INTERVENTO_DAYNAME:o[E].childnode[u].INTERVENTO_DAYNAME,FLAGNOTTURNO:o[E].childnode[u].FLAGNOTTURNO,ORAINIZIO:o[E].childnode[u].ORAINIZIO,ORAFINE:o[E].childnode[u].ORAFINE,WORKINGDAY:o[E].childnode[u].WORKINGDAY,NONWORKINGDAY:o[E].childnode[u].NONWORKINGDAY,TimeSlot:"ST3",amount:D[0].VALORE};s.push(R);I.push(R);R={}}}else if(o[E].childnode[u].ORAINIZIO>111220201730&&o[E].childnode[u].ORAINIZIO<=111220202300&&o[E].childnode[u].ORAFINE>111220202300&&o[E].childnode[u].ORAFINE<=121220200830){g=false;O=false;var f=s.filter(function(e){if(e.TimeSlot==="ST2"){g=true}return g});var p=s.filter(function(e){if(e.TimeSlot==="ST3"){O=true}return O});if(g===true){var h=l.filter(function(e){return e.ORAINIZIO==="23:00"&&e.ORAFINE==="08:30"&&e.LIVELLO===N&&e.IDTIPOGIORNO===1});if(h.length>0){var R={IDSCHEDA:o[E].childnode[u].IDSCHEDA,LIVELLO:o[E].childnode[u].LIVELLO,DATAINTERVENTO:o[E].childnode[u].DATAINTERVENTO,INTERVENTO_DATE:o[E].childnode[u].INTERVENTO_DATE,INTERVENTO_DAY:o[E].childnode[u].INTERVENTO_DAY,INTERVENTO_DAYNAME:o[E].childnode[u].INTERVENTO_DAYNAME,FLAGNOTTURNO:o[E].childnode[u].FLAGNOTTURNO,ORAINIZIO:o[E].childnode[u].ORAINIZIO,ORAFINE:o[E].childnode[u].ORAFINE,WORKINGDAY:o[E].childnode[u].WORKINGDAY,NONWORKINGDAY:o[E].childnode[u].NONWORKINGDAY,TimeSlot:"ST3",amount:h[0].VALORE};s.push(R);I.push(R);R={}}}else if(O===true){var h=l.filter(function(e){return e.ORAINIZIO==="17:30"&&e.ORAFINE==="23:00"&&e.LIVELLO===N&&e.IDTIPOGIORNO===1});if(h.length>0){var R={IDSCHEDA:o[E].childnode[u].IDSCHEDA,LIVELLO:o[E].childnode[u].LIVELLO,DATAINTERVENTO:o[E].childnode[u].DATAINTERVENTO,INTERVENTO_DATE:o[E].childnode[u].INTERVENTO_DATE,INTERVENTO_DAY:o[E].childnode[u].INTERVENTO_DAY,INTERVENTO_DAYNAME:o[E].childnode[u].INTERVENTO_DAYNAME,FLAGNOTTURNO:o[E].childnode[u].FLAGNOTTURNO,ORAINIZIO:o[E].childnode[u].ORAINIZIO,ORAFINE:o[E].childnode[u].ORAFINE,WORKINGDAY:o[E].childnode[u].WORKINGDAY,NONWORKINGDAY:o[E].childnode[u].NONWORKINGDAY,TimeSlot:"ST2",amount:h[0].VALORE};s.push(R);I.push(R);R={}}}else{var h=l.filter(function(e){return e.ORAINIZIO==="23:00"&&e.ORAFINE==="08:30"&&e.LIVELLO===N&&e.IDTIPOGIORNO===1});if(h.length>0){var R={IDSCHEDA:o[E].childnode[u].IDSCHEDA,LIVELLO:o[E].childnode[u].LIVELLO,DATAINTERVENTO:o[E].childnode[u].DATAINTERVENTO,INTERVENTO_DATE:o[E].childnode[u].INTERVENTO_DATE,INTERVENTO_DAY:o[E].childnode[u].INTERVENTO_DAY,INTERVENTO_DAYNAME:o[E].childnode[u].INTERVENTO_DAYNAME,FLAGNOTTURNO:o[E].childnode[u].FLAGNOTTURNO,ORAINIZIO:o[E].childnode[u].ORAINIZIO,ORAFINE:o[E].childnode[u].ORAFINE,WORKINGDAY:o[E].childnode[u].WORKINGDAY,NONWORKINGDAY:o[E].childnode[u].NONWORKINGDAY,TimeSlot:"ST3",amount:h[0].VALORE};s.push(R);I.push(R);R={}}}}}}else{s=[];for(var u=0;u<o[E].childnode.length;u++){if(o[E].childnode[u].ORAINIZIO>121220200830&&o[E].childnode[u].ORAINIZIO<=121220201730&&o[E].childnode[u].ORAFINE>121220200830&&o[E].childnode[u].ORAFINE<=121220201730){var M=l.filter(function(e){return e.ORAINIZIO==="08:30"&&e.ORAFINE==="17:30"&&e.LIVELLO===N&&e.IDTIPOGIORNO===2});if(M.length>0){var R={IDSCHEDA:o[E].childnode[u].IDSCHEDA,LIVELLO:o[E].childnode[u].LIVELLO,DATAINTERVENTO:o[E].childnode[u].DATAINTERVENTO,INTERVENTO_DATE:o[E].childnode[u].INTERVENTO_DATE,INTERVENTO_DAY:o[E].childnode[u].INTERVENTO_DAY,INTERVENTO_DAYNAME:o[E].childnode[u].INTERVENTO_DAYNAME,FLAGNOTTURNO:o[E].childnode[u].FLAGNOTTURNO,ORAINIZIO:o[E].childnode[u].ORAINIZIO,ORAFINE:o[E].childnode[u].ORAFINE,WORKINGDAY:o[E].childnode[u].WORKINGDAY,NONWORKINGDAY:o[E].childnode[u].NONWORKINGDAY,TimeSlot:"ST1",amount:M[0].VALORE};s.push(R);I.push(R);R={}}}else if(o[E].childnode[u].ORAINIZIO>111220201730&&o[E].childnode[u].ORAINIZIO<=111220202300&&o[E].childnode[u].ORAFINE>111220201730&&o[E].childnode[u].ORAFINE<=111220202300){var d=l.filter(function(e){return e.ORAINIZIO==="17:30"&&e.ORAFINE==="23:00"&&e.LIVELLO===N&&e.IDTIPOGIORNO===2});if(d.length>0){var R={IDSCHEDA:o[E].childnode[u].IDSCHEDA,LIVELLO:o[E].childnode[u].LIVELLO,DATAINTERVENTO:o[E].childnode[u].DATAINTERVENTO,INTERVENTO_DATE:o[E].childnode[u].INTERVENTO_DATE,INTERVENTO_DAY:o[E].childnode[u].INTERVENTO_DAY,INTERVENTO_DAYNAME:o[E].childnode[u].INTERVENTO_DAYNAME,FLAGNOTTURNO:o[E].childnode[u].FLAGNOTTURNO,ORAINIZIO:o[E].childnode[u].ORAINIZIO,ORAFINE:o[E].childnode[u].ORAFINE,WORKINGDAY:o[E].childnode[u].WORKINGDAY,NONWORKINGDAY:o[E].childnode[u].NONWORKINGDAY,TimeSlot:"ST2",amount:d[0].VALORE};s.push(R);I.push(R);R={}}}else if(o[E].childnode[u].ORAINIZIO>111220202300&&o[E].childnode[u].ORAINIZIO<=121220200830&&o[E].childnode[u].ORAFINE>111220202300&&o[E].childnode[u].ORAFINE<=121220200830){var D=l.filter(function(e){return e.ORAINIZIO==="23:00"&&e.ORAFINE==="08:30"&&e.LIVELLO===N&&e.IDTIPOGIORNO===2});if(D.length>0){var R={IDSCHEDA:o[E].childnode[u].IDSCHEDA,LIVELLO:o[E].childnode[u].LIVELLO,DATAINTERVENTO:o[E].childnode[u].DATAINTERVENTO,INTERVENTO_DATE:o[E].childnode[u].INTERVENTO_DATE,INTERVENTO_DAY:o[E].childnode[u].INTERVENTO_DAY,INTERVENTO_DAYNAME:o[E].childnode[u].INTERVENTO_DAYNAME,FLAGNOTTURNO:o[E].childnode[u].FLAGNOTTURNO,ORAINIZIO:o[E].childnode[u].ORAINIZIO,ORAFINE:o[E].childnode[u].ORAFINE,WORKINGDAY:o[E].childnode[u].WORKINGDAY,NONWORKINGDAY:o[E].childnode[u].NONWORKINGDAY,TimeSlot:"ST3",amount:D[0].VALORE};s.push(R);I.push(R);R={}}}else if(o[E].childnode[u].ORAINIZIO>121220200830&&o[E].childnode[u].ORAINIZIO<=121220201730&&o[E].childnode[u].ORAFINE>111220201730&&o[E].childnode[u].ORAFINE<=111220202300){A=false;g=false;var f=s.filter(function(e){if(e.TimeSlot==="ST1"){A=true}return A});var p=s.filter(function(e){if(e.TimeSlot==="ST2"){g=true}return g});if(A===true){var h=l.filter(function(e){return e.ORAINIZIO==="17:30"&&e.ORAFINE==="23:00"&&e.LIVELLO===N&&e.IDTIPOGIORNO===2});if(h.length>0){var R={IDSCHEDA:o[E].childnode[u].IDSCHEDA,LIVELLO:o[E].childnode[u].LIVELLO,DATAINTERVENTO:o[E].childnode[u].DATAINTERVENTO,INTERVENTO_DATE:o[E].childnode[u].INTERVENTO_DATE,INTERVENTO_DAY:o[E].childnode[u].INTERVENTO_DAY,INTERVENTO_DAYNAME:o[E].childnode[u].INTERVENTO_DAYNAME,FLAGNOTTURNO:o[E].childnode[u].FLAGNOTTURNO,ORAINIZIO:o[E].childnode[u].ORAINIZIO,ORAFINE:o[E].childnode[u].ORAFINE,WORKINGDAY:o[E].childnode[u].WORKINGDAY,NONWORKINGDAY:o[E].childnode[u].NONWORKINGDAY,TimeSlot:"ST2",amount:h[0].VALORE};s.push(R);I.push(R);R={}}}else if(g===true){var h=l.filter(function(e){return e.ORAINIZIO==="08:30"&&e.ORAFINE==="17:30"&&e.LIVELLO===N&&e.IDTIPOGIORNO===2});if(h.length>0){var R={IDSCHEDA:o[E].childnode[u].IDSCHEDA,LIVELLO:o[E].childnode[u].LIVELLO,DATAINTERVENTO:o[E].childnode[u].DATAINTERVENTO,INTERVENTO_DATE:o[E].childnode[u].INTERVENTO_DATE,INTERVENTO_DAY:o[E].childnode[u].INTERVENTO_DAY,INTERVENTO_DAYNAME:o[E].childnode[u].INTERVENTO_DAYNAME,FLAGNOTTURNO:o[E].childnode[u].FLAGNOTTURNO,ORAINIZIO:o[E].childnode[u].ORAINIZIO,ORAFINE:o[E].childnode[u].ORAFINE,WORKINGDAY:o[E].childnode[u].WORKINGDAY,NONWORKINGDAY:o[E].childnode[u].NONWORKINGDAY,TimeSlot:"ST1",amount:h[0].VALORE};s.push(R);I.push(R);R={}}}else{var h=l.filter(function(e){return e.ORAINIZIO==="17:30"&&e.ORAFINE==="23:00"&&e.LIVELLO===N&&e.IDTIPOGIORNO===2});if(h.length>0){var R={IDSCHEDA:o[E].childnode[u].IDSCHEDA,LIVELLO:o[E].childnode[u].LIVELLO,DATAINTERVENTO:o[E].childnode[u].DATAINTERVENTO,INTERVENTO_DATE:o[E].childnode[u].INTERVENTO_DATE,INTERVENTO_DAY:o[E].childnode[u].INTERVENTO_DAY,INTERVENTO_DAYNAME:o[E].childnode[u].INTERVENTO_DAYNAME,FLAGNOTTURNO:o[E].childnode[u].FLAGNOTTURNO,ORAINIZIO:o[E].childnode[u].ORAINIZIO,ORAFINE:o[E].childnode[u].ORAFINE,WORKINGDAY:o[E].childnode[u].WORKINGDAY,NONWORKINGDAY:o[E].childnode[u].NONWORKINGDAY,TimeSlot:"ST2",amount:h[0].VALORE};s.push(R);I.push(R);R={}}}}else if(o[E].childnode[u].ORAINIZIO>111220201730&&o[E].childnode[u].ORAINIZIO<=111220202300&&o[E].childnode[u].ORAFINE>111220202300&&o[E].childnode[u].ORAFINE<=121220200830){g=false;O=false;var f=s.filter(function(e){if(e.TimeSlot==="ST2"){g=true}return g});var p=s.filter(function(e){if(e.TimeSlot==="ST3"){O=true}return O});if(g===true){var h=l.filter(function(e){return e.ORAINIZIO==="23:00"&&e.ORAFINE==="08:30"&&e.LIVELLO===N&&e.IDTIPOGIORNO===2});if(h.length>0){var R={IDSCHEDA:o[E].childnode[u].IDSCHEDA,LIVELLO:o[E].childnode[u].LIVELLO,DATAINTERVENTO:o[E].childnode[u].DATAINTERVENTO,INTERVENTO_DATE:o[E].childnode[u].INTERVENTO_DATE,INTERVENTO_DAY:o[E].childnode[u].INTERVENTO_DAY,INTERVENTO_DAYNAME:o[E].childnode[u].INTERVENTO_DAYNAME,FLAGNOTTURNO:o[E].childnode[u].FLAGNOTTURNO,ORAINIZIO:o[E].childnode[u].ORAINIZIO,ORAFINE:o[E].childnode[u].ORAFINE,WORKINGDAY:o[E].childnode[u].WORKINGDAY,NONWORKINGDAY:o[E].childnode[u].NONWORKINGDAY,TimeSlot:"ST3",amount:h[0].VALORE};s.push(R);I.push(R);R={}}}else if(O===true){var h=l.filter(function(e){return e.ORAINIZIO==="17:30"&&e.ORAFINE==="23:00"&&e.LIVELLO===N&&e.IDTIPOGIORNO===2});if(h.length>0){var R={IDSCHEDA:o[E].childnode[u].IDSCHEDA,LIVELLO:o[E].childnode[u].LIVELLO,DATAINTERVENTO:o[E].childnode[u].DATAINTERVENTO,INTERVENTO_DATE:o[E].childnode[u].INTERVENTO_DATE,INTERVENTO_DAY:o[E].childnode[u].INTERVENTO_DAY,INTERVENTO_DAYNAME:o[E].childnode[u].INTERVENTO_DAYNAME,FLAGNOTTURNO:o[E].childnode[u].FLAGNOTTURNO,ORAINIZIO:o[E].childnode[u].ORAINIZIO,ORAFINE:o[E].childnode[u].ORAFINE,WORKINGDAY:o[E].childnode[u].WORKINGDAY,NONWORKINGDAY:o[E].childnode[u].NONWORKINGDAY,TimeSlot:"ST2",amount:h[0].VALORE};s.push(R);I.push(R);R={}}}else{var h=l.filter(function(e){return e.ORAINIZIO==="23:00"&&e.ORAFINE==="08:30"&&e.LIVELLO===N&&e.IDTIPOGIORNO===2});if(h.length>0){var R={IDSCHEDA:o[E].childnode[u].IDSCHEDA,LIVELLO:o[E].childnode[u].LIVELLO,DATAINTERVENTO:o[E].childnode[u].DATAINTERVENTO,INTERVENTO_DATE:o[E].childnode[u].INTERVENTO_DATE,INTERVENTO_DAY:o[E].childnode[u].INTERVENTO_DAY,INTERVENTO_DAYNAME:o[E].childnode[u].INTERVENTO_DAYNAME,FLAGNOTTURNO:o[E].childnode[u].FLAGNOTTURNO,ORAINIZIO:o[E].childnode[u].ORAINIZIO,ORAFINE:o[E].childnode[u].ORAFINE,WORKINGDAY:o[E].childnode[u].WORKINGDAY,NONWORKINGDAY:o[E].childnode[u].NONWORKINGDAY,TimeSlot:"ST3",amount:h[0].VALORE};s.push(R);I.push(R);R={}}}}}}}}if(I){var v=this.uniqueInterCalcu(I);var m=0;for(var u=0;u<v.length;u++){m=parseInt(m)+parseInt(v[u].amount)}a.INTERFlag=true;this.getOwnerComponent().getModel("viewProperties").setProperty("/TOTALE_IMPORTI_INTERVENTO",m)}},sortRepintRepInventModel:function(e){var t=e.getData().sort(function(e,t){if(e.DATE!==""&&t.DATE!==""){if(e.DATE<t.DATE)return-1;if(e.DATE>t.DATE)return 1;return 0}});return t},convDeepStarct:function(e){var t=[];var i=[];for(var r=0;r<e.length;r++){var a=t.indexOf(e[r].DATAINTERVENTO);var n,l,o,s;var I,T,A,g;if(typeof e[r].ORAINIZIO!=="number"){if(e[r].ORAINIZIO.indexOf(":")){s=e[r].ORAINIZIO.split(":")[0];o=e[r].ORAINIZIO.split(":")[1];l=parseFloat(e[r].ORAINIZIO.split(":")[0]+"."+e[r].ORAINIZIO.split(":")[1]);if(l>=0&&l<=17.29){n=parseInt("12122020"+s+""+o,10)}else{n=parseInt("11122020"+s+""+o,10)}}else{n=e[r].ORAINIZIO}}if(typeof e[r].ORAFINE!=="number"){if(e[r].ORAFINE.indexOf(":")){T=parseInt(e[r].ORAFINE.split(":")[0],10);g=e[r].ORAFINE.split(":")[0];A=e[r].ORAFINE.split(":")[1];T=parseFloat(e[r].ORAFINE.split(":")[0]+"."+e[r].ORAFINE.split(":")[1]);if(T>=0&&T<=17.29){I=parseInt("12122020"+g+""+A,10)}else{I=parseInt("11122020"+g+""+A,10)}}else{I=e[r].ORAFINE}}if(a<0){var O={date:e[r].DATAINTERVENTO,WORKINGDAY:e[r].WORKINGDAY,childnode:[{IDSCHEDA:e[r].IDSCHEDA,LIVELLO:e[r].LIVELLO,DATAINTERVENTO:e[r].DATAINTERVENTO,INTERVENTO_DATE:e[r].INTERVENTO_DATE,INTERVENTO_DAY:e[r].INTERVENTO_DAY,INTERVENTO_DAYNAME:e[r].INTERVENTO_DAYNAME,FLAGNOTTURNO:e[r].FLAGNOTTURNO,ORAINIZIO:n,ORAFINE:I,WORKINGDAY:e[r].WORKINGDAY,NONWORKINGDAY:e[r].NONWORKINGDAY,TimeSlot:e[r].TimeSlot,amount:e[r].amount}]};i.push(O);t.push(e[r].DATAINTERVENTO)}else{var O={IDSCHEDA:e[r].IDSCHEDA,LIVELLO:e[r].LIVELLO,DATAINTERVENTO:e[r].DATAINTERVENTO,INTERVENTO_DATE:e[r].INTERVENTO_DATE,INTERVENTO_DAY:e[r].INTERVENTO_DAY,INTERVENTO_DAYNAME:e[r].INTERVENTO_DAYNAME,FLAGNOTTURNO:e[r].FLAGNOTTURNO,ORAINIZIO:n,ORAFINE:I,WORKINGDAY:e[r].WORKINGDAY,NONWORKINGDAY:e[r].NONWORKINGDAY,TimeSlot:e[r].TimeSlot,amount:e[r].amount};i[a].childnode.push(O)}}return i},handleCreate:function(e){var r=this;r.invioBozzaFlag=false;r.invioFlag=false;var a=r.getView().byId("idTableReperibilita").getModel("RepintReperibilitaModel").getProperty("/");var n=r.getView().byId("idTableInterventi").getModel("RepintInterventiModel").getProperty("/");var l=r.getView().byId("idTableInterventi").getModel("RepintInterventiModel");var o=r.getView().byId("idTableInterventi").getModel("RepintInterventiModel").getData();var s=[];r.getOwnerComponent().getModel("viewProperties").setProperty("/TOTALE_GIORNI_RIPOSI_COMPENSATIVI",0);r.invioFlag=true;var I=r.getView().getModel("RepintEmpdataModel").getData();r.validateData(I,a,n);if(r.getOwnerComponent().getModel("viewProperties").getProperty("/InterventiStatus")!==undefined&&r.getOwnerComponent().getModel("viewProperties").getProperty("/ReperibilitaStatus")!==undefined&&!r.getOwnerComponent().getModel("viewProperties").getProperty("/InterventiStatus")&&!r.getOwnerComponent().getModel("viewProperties").getProperty("/ReperibilitaStatus")){i.error("Non sono stati inserite giornate di reperibilità e interventi eseguiti o programmati");return}if(r.getOwnerComponent().getModel("viewProperties").getProperty("/validData")){var T=$.unique(l.getData().map(function(e){return e.DATAINTERVENTO}));var A=[];var g={};var O=[];var N={};if(r.getOwnerComponent().getModel("viewProperties").getProperty("/ReperibilitaStatus")){for(var E=0;E<a.length;++E){if(a[E].Dom===true){a[E].TIPOGIORNO="F"}else if(a[E].Sab===true){a[E].TIPOGIORNO="S"}else{a[E].TIPOGIORNO="L"}s=[];s=a[E].DATAREPERIBILITA.split("-");g={IDSCHEDA:a[E].IDSCHEDA,IDREPERIBILITA:a[E].IDREPERIBILITA,DATAREPERIBILITA:s[2]+"-"+s[1]+"-"+s[0]+"T00:00:00",TIPOGIORNO:a[E].TIPOGIORNO};A.push(g);g={}}}else{A=[]}if(r.getOwnerComponent().getModel("viewProperties").getProperty("/InterventiStatus")){s=[];var u;var d;for(var R=0;R<n.length;++R){s=[];s=n[R].DATAINTERVENTO.split("-");u=n[R].ORAINIZIOTIMESTAMP.toUTCString();d=n[R].ORAFINETIMESTAMP.toUTCString();N={IDINTERVENTO:n[R].IDINTERVENTO,DATAINTERVENTO:s[2]+"-"+s[1]+"-"+s[0]+"T00:00:00",ORAINIZIO:n[R].ORAINIZIO,ORAFINE:n[R].ORAFINE,CHIAMATODA:n[R].CHIAMATODA===undefined?"":n[R].CHIAMATODA,CAUSA:n[R].CAUSA===null||n[R].CAUSA===undefined?"":n[R].CAUSA,FASCIA:parseInt(n[R].FASCIA),IDSCHEDA:n[R].IDSCHEDA,STESSACAUSALE:n[R].STESSACAUSALE,CONTINTERVENTO:n[R].CONTINTERVENTO===""||n[R].CONTINTERVENTO===null?0:n[R].CONTINTERVENTO,FLAGNOTTURNO:n[R].FLAGNOTTURNO?1:0,FLAGCONT:n[R].FLAGCONT?1:0,ORAFINETIMESTAMP:t.formatUTCDate(d),ORAINIZIOTIMESTAMP:t.formatUTCDate(u),WORKINGDAY:n[R].WORKINGDAY?1:0,NONWORKINGDAY:n[R].NONWORKINGDAY?1:0,CHECKOK:n[R].CHECKOK,RIPOSI:n[R].RIPOSI,CHIAMATODA_ALTRO:n[R].CHIAMATODA_ALTRO===undefined||n[R].CHIAMATODA_ALTRO===null||n[R].CHIAMATODA_ALTRO===""?"":n[R].CHIAMATODA_ALTRO,RIPOSI_HH:n[R].RIPOSI===""?0:parseInt(n[R].RIPOSI.substr(0,n[R].RIPOSI.indexOf("H"))),DURATA:parseInt(n[R].MINDIFFORAINIFINE),MINDIFFORAINIFINE:parseInt(n[R].MINDIFFORAINIFINE),TOTALE_GIORNI_RIPOSI_COMPENSATIVI:0,INTERVENTI_DETTAGLIO:""};O.push(N);N={}}}else{O=[]}var D={};s=[];if((r.getOwnerComponent().getModel("viewProperties").getProperty("/MATRICOLA_DEPUTY")===undefined||r.getOwnerComponent().getModel("viewProperties").getProperty("/MATRICOLA_DEPUTY")==="")&&I[0].MATRICOLA_RESP!==""){I[0].MATRICOLA_DEPUTY=""}else{I[0].MATRICOLA_DEPUTY=r.getOwnerComponent().getModel("viewProperties").getProperty("/MATRICOLA_DEPUTY")}var f=(new Date).toUTCString();D={IDSCHEDA:r.getOwnerComponent().getModel("viewProperties").getProperty("/IDSCHEDA"),ANNOMESE:r.getOwnerComponent().getModel("viewProperties").getProperty("/ANNOMESE").split("-")[0]+"-"+r.getOwnerComponent().getModel("viewProperties").getProperty("/ANNOMESE").split("-")[1]+"-01",STATO:100,DATACREAZIONE:t.formatUTCDate(f),ID:I[0].ID,MATRICOLA:I[0].MATRICOLA,COGNOME:I[0].COGNOME,NOME:I[0].NOME,CDC:I[0].CDC,EMAIL:I[0].EMAIL,STABILIMENTO_ATTUALE:I[0].STABILIMENTO_ATTUALE,LIVELLO:I[0].LIVELLO,MATRICOLA_RESP:I[0].MATRICOLA_RESP,MATRICOLA_DEPUTY:I[0].MATRICOLA_DEPUTY,UNITAORGANIZZATIVA:I[0].UNITAORGANIZZATIVA,DEPARTMENT:I[0].DEPARTMENT,ManagerFirstName:I[0].ManagerFirstName,ManagerLastName:I[0].ManagerLastName,Child1:A,Child2:O};var p={Object:{Header:D}};console.log("PAYLOAD");console.log(p);this.sServiceUrl=this.getOwnerComponent().getModel().sServiceUrl;$.ajax({url:this.sServiceUrl+"/",type:"GET",beforeSend:function(e){e.setRequestHeader("X-CSRF-Token","Fetch")},success:function(e,t,a){var n=a.getResponseHeader("X-CSRF-Token");$.ajax({url:"/HANAMDC/REPINT/RepintEmployee/xsjs/DeepInsert.xsjs",type:"POST",contentType:"application/json",data:JSON.stringify(p),beforeSend:function(e){e.setRequestHeader("X-CSRF-Token",n)},success:function(e,t,a){console.log("*********** SUBMIT SUCCESS ******************");i.success("Scheda inviata in approvazione");r.getView().byId("idApprovazione1").setText(sap.ui.core.format.DateFormat.getDateTimeInstance({pattern:"yyyy-MM-dd HH:MM"}).format(new Date,true));var n=r.getView().byId("idTableReperibilita").getModel("RepintReperibilitaModel");var l=r.getView().byId("idTableInterventi").getModel("RepintInterventiModel");if(n.getProperty("/").length===1&&n.getProperty("/0/DATAREPERIBILITA")!==""&&n.getProperty("/0/DATAREPERIBILITA")!==null&&n.getProperty("/0/DATAREPERIBILITA")!=undefined){n.setProperty("/0/oButton2",true)}if(l.getProperty("/").length===1&&l.getProperty("/0/DATAINTERVENTO")!==""&&l.getProperty("/0/DATAINTERVENTO")!==null&&l.getProperty("/0/DATAINTERVENTO")!=undefined){l.setProperty("/0/oButton2",true)}r.getOwnerComponent().getModel("viewProperties").setProperty("/IDSCHEDA",parseInt(e.data[1].substr(e.data[1].indexOf(":")+2)));r.getExpandData("success");r.emailTrigerOnInvio()},error:function(e,t,r){console.log("Error in DeepInsert");i.error("Errore nell'invio della scheda. Contatta l'amministratore");jQuery.sap.log.getLogger().error("Error while perfoming Invio operation in handleCreate() function. Please contact administrator."+t.toString());console.log(t)}})}})}},handleDraft:function(e){var r=this;r.invioBozzaFlag=false;r.invioFlag=false;var a=r.getView().byId("idTableReperibilita").getModel("RepintReperibilitaModel").getProperty("/");var n=r.getView().byId("idTableInterventi").getModel("RepintInterventiModel").getProperty("/");var l=r.getView().byId("idTableInterventi").getModel("RepintInterventiModel");var o=r.getView().byId("idTableInterventi").getModel("RepintInterventiModel").getData();var s=[];r.invioBozzaFlag=true;var I=r.getView().getModel("RepintEmpdataModel").getData();r.validateData(I,a,n);if(r.getOwnerComponent().getModel("viewProperties").getProperty("/InterventiStatus")!==undefined&&r.getOwnerComponent().getModel("viewProperties").getProperty("/ReperibilitaStatus")!==undefined&&!r.getOwnerComponent().getModel("viewProperties").getProperty("/InterventiStatus")&&!r.getOwnerComponent().getModel("viewProperties").getProperty("/ReperibilitaStatus")){i.error("Non sono stati inserite giornate di reperibilità e interventi eseguiti o programmati");return}if(r.getOwnerComponent().getModel("viewProperties").getProperty("/validData")){var T=$.unique(l.getData().map(function(e){return e.DATAINTERVENTO}));var A=[];var g={};var O=[];var N={};if(r.getOwnerComponent().getModel("viewProperties").getProperty("/ReperibilitaStatus")){for(var E=0;E<a.length;++E){if(a[E].Dom===true){a[E].TIPOGIORNO="F"}else if(a[E].Sab===true){a[E].TIPOGIORNO="S"}else{a[E].TIPOGIORNO="L"}s=[];s=a[E].DATAREPERIBILITA.split("-");g={IDSCHEDA:a[E].IDSCHEDA,IDREPERIBILITA:a[E].IDREPERIBILITA,DATAREPERIBILITA:s[2]+"-"+s[1]+"-"+s[0]+"T00:00:00",TIPOGIORNO:a[E].TIPOGIORNO};A.push(g);g={}}}else{A=[]}if(r.getOwnerComponent().getModel("viewProperties").getProperty("/InterventiStatus")){s=[];var u;var d;for(var R=0;R<n.length;++R){s=[];s=n[R].DATAINTERVENTO.split("-");u=n[R].ORAINIZIOTIMESTAMP.toUTCString();d=n[R].ORAFINETIMESTAMP.toUTCString();N={IDINTERVENTO:n[R].IDINTERVENTO,DATAINTERVENTO:s[2]+"-"+s[1]+"-"+s[0]+"T00:00:00",ORAINIZIO:n[R].ORAINIZIO,ORAFINE:n[R].ORAFINE,CHIAMATODA:n[R].CHIAMATODA===undefined?"":n[R].CHIAMATODA,CAUSA:n[R].CAUSA===null||n[R].CAUSA===undefined?"":n[R].CAUSA,FASCIA:parseInt(n[R].FASCIA),IDSCHEDA:n[R].IDSCHEDA,STESSACAUSALE:n[R].STESSACAUSALE,CONTINTERVENTO:n[R].CONTINTERVENTO===""||n[R].CONTINTERVENTO===null?0:n[R].CONTINTERVENTO,FLAGNOTTURNO:n[R].FLAGNOTTURNO?1:0,FLAGCONT:n[R].FLAGCONT?1:0,ORAFINETIMESTAMP:t.formatUTCDate(d),ORAINIZIOTIMESTAMP:t.formatUTCDate(u),WORKINGDAY:n[R].WORKINGDAY?1:0,NONWORKINGDAY:n[R].NONWORKINGDAY?1:0,CHECKOK:n[R].CHECKOK,RIPOSI:n[R].RIPOSI,CHIAMATODA_ALTRO:n[R].CHIAMATODA_ALTRO===undefined||n[R].CHIAMATODA_ALTRO===null||n[R].CHIAMATODA_ALTRO===""?"":n[R].CHIAMATODA_ALTRO,RIPOSI_HH:n[R].RIPOSI===""?0:parseInt(n[R].RIPOSI.substr(0,n[R].RIPOSI.indexOf("H"))),DURATA:parseInt(n[R].MINDIFFORAINIFINE),MINDIFFORAINIFINE:parseInt(n[R].MINDIFFORAINIFINE),TOTALE_GIORNI_RIPOSI_COMPENSATIVI:0,INTERVENTI_DETTAGLIO:""};O.push(N);N={}}}else{O=[]}var D={};s=[];if((r.getOwnerComponent().getModel("viewProperties").getProperty("/MATRICOLA_DEPUTY")===undefined||r.getOwnerComponent().getModel("viewProperties").getProperty("/MATRICOLA_DEPUTY")==="")&&I[0].MATRICOLA_RESP!==""){I[0].MATRICOLA_DEPUTY=""}else{I[0].MATRICOLA_DEPUTY=r.getOwnerComponent().getModel("viewProperties").getProperty("/MATRICOLA_DEPUTY")}var f=(new Date).toUTCString();D={IDSCHEDA:r.getOwnerComponent().getModel("viewProperties").getProperty("/IDSCHEDA"),ANNOMESE:r.getOwnerComponent().getModel("viewProperties").getProperty("/ANNOMESE").split("-")[0]+"-"+r.getOwnerComponent().getModel("viewProperties").getProperty("/ANNOMESE").split("-")[1]+"-01",STATO:0,DATACREAZIONE:t.formatUTCDate(f),ID:I[0].ID,MATRICOLA:I[0].MATRICOLA,COGNOME:I[0].COGNOME,NOME:I[0].NOME,CDC:I[0].CDC,EMAIL:I[0].EMAIL,STABILIMENTO_ATTUALE:I[0].STABILIMENTO_ATTUALE,LIVELLO:I[0].LIVELLO,MATRICOLA_RESP:I[0].MATRICOLA_RESP,MATRICOLA_DEPUTY:I[0].MATRICOLA_DEPUTY,UNITAORGANIZZATIVA:I[0].UNITAORGANIZZATIVA,DEPARTMENT:I[0].DEPARTMENT,ManagerFirstName:I[0].ManagerFirstName,ManagerLastName:I[0].ManagerLastName,Child1:A,Child2:O};var p={Object:{Header:D}};console.log("PAYLOAD");console.log(p);this.sServiceUrl=this.getOwnerComponent().getModel().sServiceUrl;$.ajax({url:this.sServiceUrl+"/",type:"GET",beforeSend:function(e){e.setRequestHeader("X-CSRF-Token","Fetch")},success:function(e,t,a){var n=a.getResponseHeader("X-CSRF-Token");$.ajax({url:"/HANAMDC/REPINT/RepintEmployee/xsjs/DeepInsert.xsjs",type:"POST",contentType:"application/json",data:JSON.stringify(p),beforeSend:function(e){e.setRequestHeader("X-CSRF-Token",n)},success:function(e,t,a){console.log("*********** DRAFT SUCCESS ******************");i.success("Scheda salvata in bozza");r.getView().byId("idApprovazione1").setText(sap.ui.core.format.DateFormat.getDateTimeInstance({pattern:"yyyy-MM-dd HH:MM"}).format(new Date,true));var n=r.getView().byId("idTableReperibilita").getModel("RepintReperibilitaModel");var l=r.getView().byId("idTableInterventi").getModel("RepintInterventiModel");if(n.getProperty("/").length===1&&n.getProperty("/0/DATAREPERIBILITA")!==""&&n.getProperty("/0/DATAREPERIBILITA")!==null&&n.getProperty("/0/DATAREPERIBILITA")!=undefined){n.setProperty("/0/oButton2",true)}if(l.getProperty("/").length===1&&l.getProperty("/0/DATAINTERVENTO")!==""&&l.getProperty("/0/DATAINTERVENTO")!==null&&l.getProperty("/0/DATAINTERVENTO")!=undefined){l.setProperty("/0/oButton2",true)}r.getOwnerComponent().getModel("viewProperties").setProperty("/IDSCHEDA",parseInt(e.data[1].substr(e.data[1].indexOf(":")+2)));r.getExpandData("success");r.emailTrigerOnInvio()},error:function(e,t,r){console.log("Error in DeepInsert");i.error("Errore nel salvataggio in bozza della scheda. Contatta l'amministratore");jQuery.sap.log.getLogger().error("Error while perfoming Invio Bozza. Please contact administrator."+t.toString());console.log(t)}})}})}},handleStornata:function(){var e=this;var r=e.getOwnerComponent().getModel("EmpAuthoModel");var a=e.getOwnerComponent().getModel("viewProperties").getProperty("/IDSCHEDA");var n=e.getOwnerComponent().getModel("viewProperties").getProperty("/ANNOMESE").split("-")[0]+"-"+e.getOwnerComponent().getModel("viewProperties").getProperty("/ANNOMESE").split("-")[1]+"-01T00:00:00";var l="/DATEDIPROCESSOSet?$filter=MESEANNO eq datetime'"+n+"'";var o={};var s=new sap.ui.model.json.JSONModel;var I=[];var T=new sap.ui.model.odata.ODataModel("/HANAMDC/REPINT/RepintApproval/xsodata/RepintApproval.xsodata/");T.attachRequestSent(function(){e._busyDialog.open()});T.attachRequestCompleted(function(){e._busyDialog.close()});T.read(l,{success:function(n,l){console.log(" DateSet ");console.log(n);if(n.results.length===0){i.error("Impossibile effettuare il richiamo della scheda per questo mese. Contatta l'amministratore Area HR");return}else{o={MESEANNO:t.formatUTCDate(n.results[0].MESEANNO),DIPENDENTE:t.formatUTCDate(n.results[0].DIPENDENTE)};var s=(new Date).toUTCString();var I=t.formatUTCDate(s);if(r.getData()[0].ROLE_EMP==="X"&&I<=o.DIPENDENTE){var T={};T.STATO=300;var A=e.getOwnerComponent().getModel("basexsoModel");A.update("/RepintEmpHeader("+a+")",T,{success:function(t){e.getExpandData("onload");i.success("La scheda è stata richiamata con successo")},error:function(e){i.error("Il richiamo della scheda non è andato a buon fine. Contatta l'amministratore");jQuery.sap.log.getLogger().error("Update failed"+e.toString())}})}else{i.error("La data è maggiore del mese/anno da richiamare. Contatta l'ammnistratore")}}}.bind(this),error:function(e){i.error("Impossibile ottenere le informazioni per richiamare la scheda. Contatta l'amministratore");jQuery.sap.log.getLogger().error("Data fetch failed for DATEDIPROCESSOSet.Please contact administrator."+e.toString())}.bind(this)})},emailTrigerOnInvio:function(){var e=this;var t;var r="";var a="";var n="";var l="";var o=false;var s=e.getView().getModel("RepintEmpdataModel").getData();if((e.getView().byId("idRepintCambioResp").getValue()===""||e.getView().byId("idRepintCambioResp").getValue()===undefined||e.getView().byId("idRepintCambioResp").getValue()===null)&&s[0].MATRICOLA_RESP!==""){o=true;a=s[0].ManagerFirstName;r=s[0].ManagerLastName;t="<html><head></head>MATRIDMGR = "+s[0].MATRICOLA_RESP+"<body><font>Nella tua inbox per app approval c'è la scheda per il dipendente<b> "+r+" "+a+".</b></font></body></html>";$.ajax({url:"/email/http/REPINT_Manager_Deputy_Card_Approval",type:"POST",data:t,dataType:"text",contentType:'text/xml; charset="utf-8"',success:function(e,t,i){},error:function(e,t){}})}else{var I=e.getView().getModel("RepintEmpHdrModel").getData()[0].MATRICOLA_DEPUTY;if(I!==""&&I!==null&&I!==undefined){o=true;var T=e.getView().byId("idRepintCambioResp").getModel("RepintCambioRespModel").getData();var A=jQuery.grep(T,function(e){return e.MATRICOLA_DEPUTY==I});console.log("MATRICOLA DEPUTY EMAIL");console.log(A);if(A){if(A.length>0){l=A[0].NOME_DELEGATO;n=A[0].COGNOME_DELEGATO;t="<html><head></head><body><font>Nella tua inbox per app approval c'è la scheda per il dipendente<b> "+n+" "+l+".</b></font> <br> <font><b>"+I+"</b>"+"</font></body></html>";$.ajax({url:"/email/http/REPINT_Manager_Deputy_Card_Approval",type:"POST",data:t,dataType:"text",contentType:'text/xml; charset="utf-8"',success:function(e,t,i){},error:function(e,t){}})}}}}if(!o){i.error("Mail notification cannot be triggered as the data of approver is not properly maintained")}}})});